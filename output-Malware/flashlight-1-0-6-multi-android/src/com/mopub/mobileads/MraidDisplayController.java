// 
// Decompiled by Procyon v0.5.30
// 

package com.mopub.mobileads;

import org.apache.http.client.HttpClient;
import java.io.ObjectInputStream;
import java.io.IOException;
import java.io.ObjectOutputStream;
import java.io.Serializable;
import android.net.Uri;
import android.graphics.drawable.Drawable;
import android.widget.ImageButton;
import com.mopub.common.util.Drawables;
import android.graphics.drawable.StateListDrawable;
import java.util.ArrayList;
import android.webkit.URLUtil;
import java.util.Iterator;
import android.content.ActivityNotFoundException;
import android.content.Intent;
import com.mopub.mobileads.util.Mraids;
import com.mopub.mobileads.util.Interstitials;
import android.widget.FrameLayout$LayoutParams;
import com.mopub.common.util.Dips;
import java.util.HashMap;
import android.widget.Toast;
import android.content.DialogInterface;
import android.content.DialogInterface$OnClickListener;
import android.app.AlertDialog$Builder;
import android.view.ViewGroup;
import java.util.Map;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Date;
import android.view.Window;
import android.graphics.Rect;
import android.util.DisplayMetrics;
import android.os.Environment;
import org.apache.http.Header;
import android.view.WindowManager;
import android.view.ViewGroup$LayoutParams;
import android.widget.RelativeLayout$LayoutParams;
import android.view.MotionEvent;
import android.view.View$OnTouchListener;
import java.io.Closeable;
import android.util.Log;
import com.mopub.common.util.Streams;
import java.io.FileOutputStream;
import com.mopub.mobileads.util.HttpResponses;
import com.mopub.common.util.ResponseHeader;
import org.apache.http.client.methods.HttpUriRequest;
import org.apache.http.client.methods.HttpGet;
import com.mopub.mobileads.factories.HttpClientFactory;
import android.media.MediaScannerConnection$MediaScannerConnectionClient;
import java.io.File;
import java.io.OutputStream;
import java.io.InputStream;
import android.media.MediaScannerConnection;
import org.apache.http.HttpResponse;
import java.net.URI;
import android.content.Context;
import android.view.View;
import android.app.Activity;
import android.os.Handler;
import android.widget.RelativeLayout;
import android.view.View$OnClickListener;
import android.widget.ImageView;
import android.widget.FrameLayout;

class MraidDisplayController extends MraidAbstractController
{
    private static final int CLOSE_BUTTON_SIZE_DP = 50;
    private static final String[] DATE_FORMATS;
    private static final String LOGTAG = "MraidDisplayController";
    private static final int MAX_NUMBER_DAYS_IN_MONTH = 31;
    private static final long VIEWABILITY_TIMER_MILLIS = 3000L;
    private FrameLayout mAdContainerLayout;
    private boolean mAdWantsCustomCloseButton;
    private ImageView mCloseButton;
    private final View$OnClickListener mCloseOnClickListener;
    protected float mDensity;
    private RelativeLayout mExpansionLayout;
    private final MraidView$ExpansionStyle mExpansionStyle;
    private Handler mHandler;
    private final MraidView$NativeCloseButtonStyle mNativeCloseButtonStyle;
    private MraidDisplayController$OrientationBroadcastReceiver mOrientationBroadcastReceiver;
    private final int mOriginalRequestedOrientation;
    private FrameLayout mPlaceholderView;
    private FrameLayout mRootView;
    protected int mScreenHeight;
    protected int mScreenWidth;
    private MraidView mTwoPartExpansionView;
    private int mViewIndexInParent;
    private MraidView$ViewState mViewState;
    
    static {
        DATE_FORMATS = new String[] { "yyyy-MM-dd'T'HH:mm:ssZZZZZ", "yyyy-MM-dd'T'HH:mmZZZZZ" };
    }
    
    MraidDisplayController(final MraidView mraidView, final MraidView$ExpansionStyle mExpansionStyle, final MraidView$NativeCloseButtonStyle mNativeCloseButtonStyle) {
        super(mraidView);
        this.mViewState = MraidView$ViewState.HIDDEN;
        this.mHandler = new Handler();
        this.mOrientationBroadcastReceiver = new MraidDisplayController$OrientationBroadcastReceiver(this);
        this.mScreenWidth = -1;
        this.mScreenHeight = -1;
        this.mExpansionStyle = mExpansionStyle;
        this.mNativeCloseButtonStyle = mNativeCloseButtonStyle;
        final Context context = this.getContext();
        int requestedOrientation;
        if (context instanceof Activity) {
            requestedOrientation = ((Activity)context).getRequestedOrientation();
        }
        else {
            requestedOrientation = -1;
        }
        this.mOriginalRequestedOrientation = requestedOrientation;
        this.initialize();
        this.mCloseOnClickListener = (View$OnClickListener)new View$OnClickListener() {
            public void onClick(final View view) {
                MraidDisplayController.this.close();
            }
        };
        this.mAdContainerLayout = this.createAdContainerLayout();
        this.mExpansionLayout = this.createExpansionLayout();
        this.mPlaceholderView = this.createPlaceholderView();
    }
    
    private String dayNumberToDayOfMonthString(final int n) {
        if (n != 0 && n >= -31 && n <= 31) {
            return new StringBuilder().append(n).toString();
        }
        throw new IllegalArgumentException("invalid day of month " + n);
    }
    
    private String dayNumberToDayOfWeekString(final int n) {
        switch (n) {
            default: {
                throw new IllegalArgumentException("invalid day of week " + n);
            }
            case 0: {
                return "SU";
            }
            case 1: {
                return "MO";
            }
            case 2: {
                return "TU";
            }
            case 3: {
                return "WE";
            }
            case 4: {
                return "TH";
            }
            case 5: {
                return "FR";
            }
            case 6: {
                return "SA";
            }
        }
    }
    
    private void downloadImage(final String s) {
        final File pictureStoragePath = this.getPictureStoragePath();
        pictureStoragePath.mkdirs();
        new Thread(new Runnable() {
            private MediaScannerConnection mediaScannerConnection;
            private InputStream pictureInputStream;
            private OutputStream pictureOutputStream;
            private URI uri;
            
            private void loadPictureIntoGalleryApp(final String s) {
                final MraidDisplayController$MoPubMediaScannerConnectionClient mraidDisplayController$MoPubMediaScannerConnectionClient = new MraidDisplayController$MoPubMediaScannerConnectionClient(MraidDisplayController.this, s, null, null);
                MraidDisplayController$MoPubMediaScannerConnectionClient.access$1(mraidDisplayController$MoPubMediaScannerConnectionClient, this.mediaScannerConnection = new MediaScannerConnection(MraidDisplayController.this.getContext().getApplicationContext(), (MediaScannerConnection$MediaScannerConnectionClient)mraidDisplayController$MoPubMediaScannerConnectionClient));
                this.mediaScannerConnection.connect();
            }
            
            @Override
            public void run() {
                try {
                    this.uri = URI.create(s);
                    final HttpResponse execute = ((HttpClient)HttpClientFactory.create()).execute((HttpUriRequest)new HttpGet(this.uri));
                    this.pictureInputStream = execute.getEntity().getContent();
                    final String header = HttpResponses.extractHeader(execute, ResponseHeader.LOCATION);
                    if (header != null) {
                        this.uri = URI.create(header);
                    }
                    final File file = new File(pictureStoragePath, MraidDisplayController.this.getFileNameForUriAndHttpResponse(this.uri, execute));
                    final String string = file.toString();
                    this.pictureOutputStream = new FileOutputStream(file);
                    Streams.copyContent(this.pictureInputStream, this.pictureOutputStream);
                    this.loadPictureIntoGalleryApp(string);
                }
                catch (Exception ex) {
                    MraidDisplayController.this.mHandler.post((Runnable)new Runnable() {
                        @Override
                        public void run() {
                            MraidDisplayController.this.showUserToast("Image failed to download.");
                            MraidDisplayController.this.getMraidView().fireErrorEvent(MraidCommandFactory$MraidJavascriptCommand.STORE_PICTURE, "Error downloading and saving image file.");
                            Log.d("MoPub", "Error downloading and saving image file.");
                        }
                    });
                }
                finally {
                    Streams.closeStream(this.pictureInputStream);
                    Streams.closeStream(this.pictureOutputStream);
                }
            }
        }).start();
    }
    
    private void expandLayouts(final View view, int n, int n2) {
        final int n3 = (int)(0.5f + 50.0f * this.mDensity);
        if (n < n3) {
            n = n3;
        }
        if (n2 < n3) {
            n2 = n3;
        }
        final View view2 = new View(this.getContext());
        view2.setBackgroundColor(0);
        view2.setOnTouchListener((View$OnTouchListener)new View$OnTouchListener() {
            public boolean onTouch(final View view, final MotionEvent motionEvent) {
                return true;
            }
        });
        this.mExpansionLayout.addView(view2, (ViewGroup$LayoutParams)new RelativeLayout$LayoutParams(-1, -1));
        this.mAdContainerLayout.addView(view, (ViewGroup$LayoutParams)new RelativeLayout$LayoutParams(-1, -1));
        this.addCloseEventRegion(this.mAdContainerLayout);
        final RelativeLayout$LayoutParams relativeLayout$LayoutParams = new RelativeLayout$LayoutParams(n, n2);
        relativeLayout$LayoutParams.addRule(13);
        this.mExpansionLayout.addView((View)this.mAdContainerLayout, (ViewGroup$LayoutParams)relativeLayout$LayoutParams);
    }
    
    private Context getContext() {
        return this.getMraidView().getContext();
    }
    
    private int getDisplayRotation() {
        return ((WindowManager)this.getContext().getSystemService("window")).getDefaultDisplay().getOrientation();
    }
    
    private String getFileNameForUriAndHttpResponse(final URI uri, final HttpResponse httpResponse) {
        final String path = uri.getPath();
        String name;
        if (path == null) {
            name = null;
        }
        else {
            name = new File(path).getName();
            final Header firstHeader = httpResponse.getFirstHeader("Content-Type");
            if (firstHeader != null) {
                final String[] split = firstHeader.getValue().split(";");
                final int length = split.length;
                int i = 0;
                while (i < length) {
                    final String s = split[i];
                    if (s.contains("image/")) {
                        final String string = "." + s.split("/")[1];
                        if (!name.endsWith(string)) {
                            return String.valueOf(name) + string;
                        }
                        break;
                    }
                    else {
                        ++i;
                    }
                }
            }
        }
        return name;
    }
    
    private File getPictureStoragePath() {
        return new File(Environment.getExternalStorageDirectory(), "Pictures");
    }
    
    private void initialize() {
        this.mViewState = MraidView$ViewState.LOADING;
        this.initializeScreenMetrics();
        this.mOrientationBroadcastReceiver.register(this.getContext());
    }
    
    private void initializeScreenMetrics() {
        final Context context = this.getContext();
        final DisplayMetrics displayMetrics = new DisplayMetrics();
        ((WindowManager)context.getSystemService("window")).getDefaultDisplay().getMetrics(displayMetrics);
        this.mDensity = displayMetrics.density;
        int top;
        int n;
        if (context instanceof Activity) {
            final Window window = ((Activity)context).getWindow();
            final Rect rect = new Rect();
            window.getDecorView().getWindowVisibleDisplayFrame(rect);
            top = rect.top;
            n = window.findViewById(16908290).getTop() - top;
        }
        else {
            n = 0;
            top = 0;
        }
        final int widthPixels = displayMetrics.widthPixels;
        final int n2 = displayMetrics.heightPixels - top - n;
        this.mScreenWidth = (int)(widthPixels * (160.0 / displayMetrics.densityDpi));
        this.mScreenHeight = (int)(n2 * (160.0 / displayMetrics.densityDpi));
    }
    
    private void onOrientationChanged(final int n) {
        this.initializeScreenMetrics();
        this.getMraidView().fireChangeEventForProperty(MraidScreenSizeProperty.createWithSize(this.mScreenWidth, this.mScreenHeight));
    }
    
    private Date parseDate(final String s) {
        Date parse = null;
        int i = 0;
        while (i < MraidDisplayController.DATE_FORMATS.length) {
            while (true) {
                try {
                    parse = new SimpleDateFormat(MraidDisplayController.DATE_FORMATS[i]).parse(s);
                    if (parse != null) {
                        break;
                    }
                    ++i;
                }
                catch (ParseException ex) {
                    continue;
                }
                break;
            }
        }
        return parse;
    }
    
    private String parseRecurrenceRule(final Map map) {
        final StringBuilder sb = new StringBuilder();
        if (map.containsKey("frequency")) {
            final String s = map.get("frequency");
            int int1;
            if (map.containsKey("interval")) {
                int1 = Integer.parseInt(map.get("interval"));
            }
            else {
                int1 = -1;
            }
            if ("daily".equals(s)) {
                sb.append("FREQ=DAILY;");
                if (int1 != -1) {
                    sb.append("INTERVAL=" + int1 + ";");
                }
            }
            else if ("weekly".equals(s)) {
                sb.append("FREQ=WEEKLY;");
                if (int1 != -1) {
                    sb.append("INTERVAL=" + int1 + ";");
                }
                if (map.containsKey("daysInWeek")) {
                    final String translateWeekIntegersToDays = this.translateWeekIntegersToDays(map.get("daysInWeek"));
                    if (translateWeekIntegersToDays == null) {
                        throw new IllegalArgumentException("invalid ");
                    }
                    sb.append("BYDAY=" + translateWeekIntegersToDays + ";");
                }
            }
            else {
                if (!"monthly".equals(s)) {
                    throw new IllegalArgumentException("frequency is only supported for daily, weekly, and monthly.");
                }
                sb.append("FREQ=MONTHLY;");
                if (int1 != -1) {
                    sb.append("INTERVAL=" + int1 + ";");
                }
                if (map.containsKey("daysInMonth")) {
                    final String translateMonthIntegersToDays = this.translateMonthIntegersToDays(map.get("daysInMonth"));
                    if (translateMonthIntegersToDays == null) {
                        throw new IllegalArgumentException();
                    }
                    sb.append("BYMONTHDAY=" + translateMonthIntegersToDays + ";");
                }
            }
        }
        return sb.toString();
    }
    
    private void resetViewToDefaultState() {
        this.setNativeCloseButtonEnabled(false);
        this.mAdContainerLayout.removeAllViewsInLayout();
        this.mExpansionLayout.removeAllViewsInLayout();
        this.mRootView.removeView((View)this.mExpansionLayout);
        this.getMraidView().requestLayout();
        final ViewGroup viewGroup = (ViewGroup)this.mPlaceholderView.getParent();
        viewGroup.addView((View)this.getMraidView(), this.mViewIndexInParent);
        viewGroup.removeView((View)this.mPlaceholderView);
        viewGroup.invalidate();
    }
    
    private void setOrientationLockEnabled(final boolean b) {
        final Context context = this.getContext();
        try {
            final Activity activity = (Activity)context;
            int requestedOrientation;
            if (b) {
                requestedOrientation = activity.getResources().getConfiguration().orientation;
            }
            else {
                requestedOrientation = this.mOriginalRequestedOrientation;
            }
            activity.setRequestedOrientation(requestedOrientation);
        }
        catch (ClassCastException ex) {
            Log.d("MraidDisplayController", "Unable to modify device orientation.");
        }
    }
    
    private void showUserDialog(final String s) {
        new AlertDialog$Builder(this.getContext()).setTitle((CharSequence)"Save Image").setMessage((CharSequence)"Download image to Picture gallery?").setNegativeButton((CharSequence)"Cancel", (DialogInterface$OnClickListener)null).setPositiveButton((CharSequence)"Okay", (DialogInterface$OnClickListener)new DialogInterface$OnClickListener() {
            public void onClick(final DialogInterface dialogInterface, final int n) {
                MraidDisplayController.this.downloadImage(s);
            }
        }).setCancelable(true).show();
    }
    
    private void showUserToast(final String s) {
        this.mHandler.post((Runnable)new Runnable() {
            @Override
            public void run() {
                Toast.makeText(MraidDisplayController.this.getContext(), (CharSequence)s, 0).show();
            }
        });
    }
    
    private void swapViewWithPlaceholderView() {
        final ViewGroup viewGroup = (ViewGroup)this.getMraidView().getParent();
        if (viewGroup == null) {
            return;
        }
        int childCount;
        int mViewIndexInParent;
        for (childCount = viewGroup.getChildCount(), mViewIndexInParent = 0; mViewIndexInParent < childCount && viewGroup.getChildAt(mViewIndexInParent) != this.getMraidView(); ++mViewIndexInParent) {}
        this.mViewIndexInParent = mViewIndexInParent;
        viewGroup.addView((View)this.mPlaceholderView, mViewIndexInParent, new ViewGroup$LayoutParams(this.getMraidView().getWidth(), this.getMraidView().getHeight()));
        viewGroup.removeView((View)this.getMraidView());
    }
    
    private Map translateJSParamsToAndroidCalendarEventMapping(final Map map) {
        final HashMap<String, String> hashMap = new HashMap<String, String>();
        if (!map.containsKey("description") || !map.containsKey("start")) {
            throw new IllegalArgumentException("Missing start and description fields");
        }
        hashMap.put("title", map.get("description"));
        if (!map.containsKey("start") || map.get("start") == null) {
            throw new IllegalArgumentException("Invalid calendar event: start is null.");
        }
        final Date date = this.parseDate(map.get("start"));
        if (date != null) {
            hashMap.put("beginTime", (String)date.getTime());
            if (map.containsKey("end") && map.get("end") != null) {
                final Date date2 = this.parseDate(map.get("end"));
                if (date2 == null) {
                    throw new IllegalArgumentException("Invalid calendar event: end time is malformed. Date format expecting (yyyy-MM-DDTHH:MM:SS-xx:xx) or (yyyy-MM-DDTHH:MM-xx:xx) i.e. 2013-08-14T09:00:01-08:00");
                }
                hashMap.put("endTime", (String)date2.getTime());
            }
            if (map.containsKey("location")) {
                hashMap.put("eventLocation", map.get("location"));
            }
            if (map.containsKey("summary")) {
                hashMap.put("description", map.get("summary"));
            }
            if (map.containsKey("transparency")) {
                int n;
                if (map.get("transparency").equals("transparent")) {
                    n = 1;
                }
                else {
                    n = 0;
                }
                hashMap.put("availability", (String)n);
            }
            hashMap.put("rrule", this.parseRecurrenceRule(map));
            return hashMap;
        }
        throw new IllegalArgumentException("Invalid calendar event: start time is malformed. Date format expecting (yyyy-MM-DDTHH:MM:SS-xx:xx) or (yyyy-MM-DDTHH:MM-xx:xx) i.e. 2013-08-14T09:00:01-08:00");
    }
    
    private String translateMonthIntegersToDays(final String s) {
        final StringBuilder sb = new StringBuilder();
        final boolean[] array = new boolean[63];
        final String[] split = s.split(",");
        for (int i = 0; i < split.length; ++i) {
            final int int1 = Integer.parseInt(split[i]);
            if (!array[int1 + 31]) {
                sb.append(String.valueOf(this.dayNumberToDayOfMonthString(int1)) + ",");
                array[int1 + 31] = true;
            }
        }
        if (split.length == 0) {
            throw new IllegalArgumentException("must have at least 1 day of the month if specifying repeating weekly");
        }
        sb.deleteCharAt(-1 + sb.length());
        return sb.toString();
    }
    
    private String translateWeekIntegersToDays(final String s) {
        final StringBuilder sb = new StringBuilder();
        final boolean[] array = new boolean[7];
        final String[] split = s.split(",");
        for (int i = 0; i < split.length; ++i) {
            int int1 = Integer.parseInt(split[i]);
            if (int1 == 7) {
                int1 = 0;
            }
            if (!array[int1]) {
                sb.append(String.valueOf(this.dayNumberToDayOfWeekString(int1)) + ",");
                array[int1] = true;
            }
        }
        if (split.length == 0) {
            throw new IllegalArgumentException("must have at least 1 day of the week if specifying repeating weekly");
        }
        sb.deleteCharAt(-1 + sb.length());
        return sb.toString();
    }
    
    void addCloseEventRegion(final FrameLayout frameLayout) {
        final int dipsToIntPixels = Dips.dipsToIntPixels(50.0f, this.getContext());
        Interstitials.addCloseEventRegion((ViewGroup)frameLayout, (ViewGroup$LayoutParams)new FrameLayout$LayoutParams(dipsToIntPixels, dipsToIntPixels, 53), this.mCloseOnClickListener);
    }
    
    protected void close() {
        if (this.mViewState == MraidView$ViewState.EXPANDED) {
            this.resetViewToDefaultState();
            this.setOrientationLockEnabled(false);
            this.mViewState = MraidView$ViewState.DEFAULT;
            this.getMraidView().fireChangeEventForProperty(MraidStateProperty.createWithViewState(this.mViewState));
        }
        else if (this.mViewState == MraidView$ViewState.DEFAULT) {
            this.getMraidView().setVisibility(4);
            this.mViewState = MraidView$ViewState.HIDDEN;
            this.getMraidView().fireChangeEventForProperty(MraidStateProperty.createWithViewState(this.mViewState));
        }
        if (this.getMraidView().getMraidListener() != null) {
            this.getMraidView().getMraidListener().onClose(this.getMraidView(), this.mViewState);
        }
    }
    
    FrameLayout createAdContainerLayout() {
        return new FrameLayout(this.getContext());
    }
    
    protected void createCalendarEvent(final Map map) {
        final Context context = this.getMraidView().getContext();
        if (Mraids.isCalendarAvailable(context)) {
            try {
                final Map translateJSParamsToAndroidCalendarEventMapping = this.translateJSParamsToAndroidCalendarEventMapping(map);
                final Intent setType = new Intent("android.intent.action.INSERT").setType("vnd.android.cursor.item/event");
                for (final String s : translateJSParamsToAndroidCalendarEventMapping.keySet()) {
                    final V value = translateJSParamsToAndroidCalendarEventMapping.get(s);
                    if (!(value instanceof Long)) {
                        goto Label_0155;
                    }
                    setType.putExtra(s, (long)value);
                }
                setType.setFlags(268435456);
                context.startActivity(setType);
                return;
            }
            catch (ActivityNotFoundException ex2) {
                Log.d("MraidDisplayController", "no calendar app installed");
                this.getMraidView().fireErrorEvent(MraidCommandFactory$MraidJavascriptCommand.CREATE_CALENDAR_EVENT, "Action is unsupported on this device - no calendar app installed");
                return;
            }
            catch (IllegalArgumentException ex) {
                Log.d("MraidDisplayController", "create calendar: invalid parameters " + ex.getMessage());
                this.getMraidView().fireErrorEvent(MraidCommandFactory$MraidJavascriptCommand.CREATE_CALENDAR_EVENT, ex.getMessage());
                return;
            }
            catch (Exception ex3) {
                Log.d("MraidDisplayController", "could not create calendar event");
                this.getMraidView().fireErrorEvent(MraidCommandFactory$MraidJavascriptCommand.CREATE_CALENDAR_EVENT, "could not create calendar event");
                return;
            }
        }
        Log.d("MraidDisplayController", "unsupported action createCalendarEvent for devices pre-ICS");
        this.getMraidView().fireErrorEvent(MraidCommandFactory$MraidJavascriptCommand.CREATE_CALENDAR_EVENT, "Action is unsupported on this device (need Android version Ice Cream Sandwich or above)");
    }
    
    RelativeLayout createExpansionLayout() {
        return new RelativeLayout(this.getContext());
    }
    
    FrameLayout createPlaceholderView() {
        return new FrameLayout(this.getContext());
    }
    
    public void destroy() {
        try {
            this.mOrientationBroadcastReceiver.unregister();
        }
        catch (IllegalArgumentException ex) {
            if (!ex.getMessage().contains("Receiver not registered")) {
                throw ex;
            }
        }
    }
    
    protected void expand(final String s, final int n, final int n2, final boolean b, final boolean orientationLockEnabled) {
        if (this.mExpansionStyle != MraidView$ExpansionStyle.DISABLED) {
            if (s != null && !URLUtil.isValidUrl(s)) {
                this.getMraidView().fireErrorEvent(MraidCommandFactory$MraidJavascriptCommand.EXPAND, "URL passed to expand() was invalid.");
                return;
            }
            this.mRootView = (FrameLayout)this.getMraidView().getRootView().findViewById(16908290);
            this.useCustomClose(b);
            this.setOrientationLockEnabled(orientationLockEnabled);
            this.swapViewWithPlaceholderView();
            MraidView mraidView = this.getMraidView();
            if (s != null) {
                (this.mTwoPartExpansionView = new MraidView(this.getContext(), this.getMraidView().getAdConfiguration(), MraidView$ExpansionStyle.DISABLED, MraidView$NativeCloseButtonStyle.AD_CONTROLLED, MraidView$PlacementType.INLINE)).setMraidListener(new MraidView$BaseMraidListener() {
                    @Override
                    public void onClose(final MraidView mraidView, final MraidView$ViewState mraidView$ViewState) {
                        MraidDisplayController.this.close();
                    }
                });
                this.mTwoPartExpansionView.loadUrl(s);
                mraidView = this.mTwoPartExpansionView;
            }
            this.expandLayouts((View)mraidView, (int)(n * this.mDensity), (int)(n2 * this.mDensity));
            this.mRootView.addView((View)this.mExpansionLayout, (ViewGroup$LayoutParams)new RelativeLayout$LayoutParams(-1, -1));
            if (this.mNativeCloseButtonStyle == MraidView$NativeCloseButtonStyle.ALWAYS_VISIBLE || (!this.mAdWantsCustomCloseButton && this.mNativeCloseButtonStyle != MraidView$NativeCloseButtonStyle.ALWAYS_HIDDEN)) {
                this.setNativeCloseButtonEnabled(true);
            }
            this.mViewState = MraidView$ViewState.EXPANDED;
            this.getMraidView().fireChangeEventForProperty(MraidStateProperty.createWithViewState(this.mViewState));
            if (this.getMraidView().getMraidListener() != null) {
                this.getMraidView().getMraidListener().onExpand(this.getMraidView());
            }
        }
    }
    
    @Deprecated
    public View$OnClickListener getCloseOnClickListener() {
        return this.mCloseOnClickListener;
    }
    
    protected void getCurrentPosition() {
        this.getMraidView().fireErrorEvent(MraidCommandFactory$MraidJavascriptCommand.GET_CURRENT_POSITION, "Unsupported action getCurrentPosition");
    }
    
    protected void getDefaultPosition() {
        this.getMraidView().fireErrorEvent(MraidCommandFactory$MraidJavascriptCommand.GET_DEFAULT_POSITION, "Unsupported action getDefaultPosition");
    }
    
    protected void getMaxSize() {
        this.getMraidView().fireErrorEvent(MraidCommandFactory$MraidJavascriptCommand.GET_MAX_SIZE, "Unsupported action getMaxSize");
    }
    
    protected void getScreenSize() {
        this.getMraidView().fireErrorEvent(MraidCommandFactory$MraidJavascriptCommand.GET_SCREEN_SIZE, "Unsupported action getScreenSize");
    }
    
    protected void initializeJavaScriptState() {
        final ArrayList<MraidScreenSizeProperty> list = new ArrayList<MraidScreenSizeProperty>();
        list.add(MraidScreenSizeProperty.createWithSize(this.mScreenWidth, this.mScreenHeight));
        list.add((MraidScreenSizeProperty)MraidViewableProperty.createWithViewable(this.getMraidView().getIsVisible()));
        this.getMraidView().fireChangeEventForProperties(list);
        this.mViewState = MraidView$ViewState.DEFAULT;
        this.getMraidView().fireChangeEventForProperty(MraidStateProperty.createWithViewState(this.mViewState));
        this.initializeSupportedFunctionsProperty();
    }
    
    protected void initializeSupportedFunctionsProperty() {
        final Context context = this.getContext();
        this.getMraidView().fireChangeEventForProperty(new MraidSupportsProperty().withTel(Mraids.isTelAvailable(context)).withSms(Mraids.isSmsAvailable(context)).withCalendar(Mraids.isCalendarAvailable(context)).withInlineVideo(Mraids.isInlineVideoAvailable(context)).withStorePicture(Mraids.isStorePictureSupported(context)));
    }
    
    protected boolean isExpanded() {
        return this.mViewState == MraidView$ViewState.EXPANDED;
    }
    
    protected void setNativeCloseButtonEnabled(final boolean b) {
        if (this.mRootView != null) {
            if (b) {
                if (this.mCloseButton == null) {
                    final StateListDrawable imageDrawable = new StateListDrawable();
                    imageDrawable.addState(new int[] { -16842919 }, Drawables.INTERSTITIAL_CLOSE_BUTTON_NORMAL.decodeImage(this.mRootView.getContext()));
                    imageDrawable.addState(new int[] { 16842919 }, Drawables.INTERSTITIAL_CLOSE_BUTTON_PRESSED.decodeImage(this.mRootView.getContext()));
                    (this.mCloseButton = (ImageView)new ImageButton(this.getContext())).setImageDrawable((Drawable)imageDrawable);
                    this.mCloseButton.setBackgroundDrawable((Drawable)null);
                    this.mCloseButton.setOnClickListener((View$OnClickListener)new View$OnClickListener() {
                        public void onClick(final View view) {
                            MraidDisplayController.this.close();
                        }
                    });
                }
                final int dipsToIntPixels = Dips.dipsToIntPixels(50.0f, this.getContext());
                this.mAdContainerLayout.addView((View)this.mCloseButton, (ViewGroup$LayoutParams)new FrameLayout$LayoutParams(dipsToIntPixels, dipsToIntPixels, 5));
            }
            else {
                this.mAdContainerLayout.removeView((View)this.mCloseButton);
            }
            final MraidView mraidView = this.getMraidView();
            if (mraidView.getOnCloseButtonStateChangeListener() != null) {
                mraidView.getOnCloseButtonStateChangeListener().onCloseButtonStateChange(mraidView, b);
            }
        }
    }
    
    protected void showUserDownloadImageAlert(final String s) {
        final Context context = this.getContext();
        if (!Mraids.isStorePictureSupported(context)) {
            this.getMraidView().fireErrorEvent(MraidCommandFactory$MraidJavascriptCommand.STORE_PICTURE, "Error downloading file - the device does not have an SD card mounted, or the Android permission is not granted.");
            Log.d("MoPub", "Error downloading file - the device does not have an SD card mounted, or the Android permission is not granted.");
            return;
        }
        if (context instanceof Activity) {
            this.showUserDialog(s);
            return;
        }
        this.showUserToast("Downloading image to Picture gallery...");
        this.downloadImage(s);
    }
    
    protected void showVideo(final String s) {
        BaseVideoPlayerActivity.startMraid(this.getContext(), s, this.getMraidView().getAdConfiguration());
    }
    
    protected void useCustomClose(final boolean mAdWantsCustomCloseButton) {
        this.mAdWantsCustomCloseButton = mAdWantsCustomCloseButton;
        final MraidView mraidView = this.getMraidView();
        final boolean b = !mAdWantsCustomCloseButton;
        if (mraidView.getOnCloseButtonStateChangeListener() != null) {
            mraidView.getOnCloseButtonStateChangeListener().onCloseButtonStateChange(mraidView, b);
        }
    }
}
