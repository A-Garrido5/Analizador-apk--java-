// 
// Decompiled by Procyon v0.5.30
// 

package com.mopub.common;

import com.mopub.common.util.IntentUtils;
import android.net.NetworkInfo;
import com.mopub.common.util.DateAndTime;
import java.text.SimpleDateFormat;
import android.telephony.TelephonyManager;
import android.location.Location;
import android.content.Context;
import android.net.ConnectivityManager;

public abstract class AdUrlGenerator extends BaseUrlGenerator
{
    public static final String DEVICE_ORIENTATION_LANDSCAPE = "l";
    public static final String DEVICE_ORIENTATION_PORTRAIT = "p";
    public static final String DEVICE_ORIENTATION_SQUARE = "s";
    public static final String DEVICE_ORIENTATION_UNKNOWN = "u";
    public static final int TYPE_DUMMY = 8;
    public static final int TYPE_ETHERNET = 9;
    public static final int TYPE_MOBILE_DUN = 4;
    public static final int TYPE_MOBILE_HIPRI = 5;
    public static final int TYPE_MOBILE_MMS = 2;
    public static final int TYPE_MOBILE_SUPL = 3;
    private static AdUrlGenerator$TwitterAppInstalledStatus sTwitterAppInstalledStatus;
    protected String mAdUnitId;
    protected ConnectivityManager mConnectivityManager;
    protected Context mContext;
    protected boolean mFacebookSupportEnabled;
    protected String mKeywords;
    protected Location mLocation;
    protected TelephonyManager mTelephonyManager;
    
    static {
        AdUrlGenerator.sTwitterAppInstalledStatus = AdUrlGenerator$TwitterAppInstalledStatus.UNKNOWN;
    }
    
    public AdUrlGenerator(final Context mContext) {
        this.mContext = mContext;
        this.mTelephonyManager = (TelephonyManager)this.mContext.getSystemService("phone");
        this.mConnectivityManager = (ConnectivityManager)this.mContext.getSystemService("connectivity");
    }
    
    private void addParam(final String s, final AdUrlGenerator$MoPubNetworkType adUrlGenerator$MoPubNetworkType) {
        this.addParam(s, adUrlGenerator$MoPubNetworkType.toString());
    }
    
    protected static String getTimeZoneOffsetString() {
        final SimpleDateFormat simpleDateFormat = new SimpleDateFormat("Z");
        simpleDateFormat.setTimeZone(DateAndTime.localTimeZone());
        return simpleDateFormat.format(DateAndTime.now());
    }
    
    private int mncPortionLength(final String s) {
        return Math.min(3, s.length());
    }
    
    @Deprecated
    public static void setTwitterAppInstalledStatus(final AdUrlGenerator$TwitterAppInstalledStatus sTwitterAppInstalledStatus) {
        AdUrlGenerator.sTwitterAppInstalledStatus = sTwitterAppInstalledStatus;
    }
    
    protected int getActiveNetworkType() {
        int type = 8;
        if (this.mContext.checkCallingOrSelfPermission("android.permission.ACCESS_NETWORK_STATE") == 0) {
            final NetworkInfo activeNetworkInfo = this.mConnectivityManager.getActiveNetworkInfo();
            if (activeNetworkInfo != null) {
                type = activeNetworkInfo.getType();
            }
        }
        return type;
    }
    
    protected String getNetworkOperator() {
        String s = this.mTelephonyManager.getNetworkOperator();
        if (this.mTelephonyManager.getPhoneType() == 2 && this.mTelephonyManager.getSimState() == 5) {
            s = this.mTelephonyManager.getSimOperator();
        }
        return s;
    }
    
    public AdUrlGenerator$TwitterAppInstalledStatus getTwitterAppInstallStatus() {
        if (IntentUtils.canHandleTwitterUrl(this.mContext)) {
            return AdUrlGenerator$TwitterAppInstalledStatus.INSTALLED;
        }
        return AdUrlGenerator$TwitterAppInstalledStatus.NOT_INSTALLED;
    }
    
    protected void setAdUnitId(final String s) {
        this.addParam("id", s);
    }
    
    protected void setCarrierName(final String s) {
        this.addParam("cn", s);
    }
    
    protected void setDensity(final float n) {
        this.addParam("sc_a", new StringBuilder().append(n).toString());
    }
    
    protected void setIsoCountryCode(final String s) {
        this.addParam("iso", s);
    }
    
    protected void setKeywords(final String s) {
        this.addParam("q", s);
    }
    
    protected void setLocation(final Location location) {
        if (location != null) {
            this.addParam("ll", String.valueOf(location.getLatitude()) + "," + location.getLongitude());
            this.addParam("lla", new StringBuilder().append((int)location.getAccuracy()).toString());
        }
    }
    
    protected void setMccCode(final String s) {
        String substring;
        if (s == null) {
            substring = "";
        }
        else {
            substring = s.substring(0, this.mncPortionLength(s));
        }
        this.addParam("mcc", substring);
    }
    
    protected void setMncCode(final String s) {
        String substring;
        if (s == null) {
            substring = "";
        }
        else {
            substring = s.substring(this.mncPortionLength(s));
        }
        this.addParam("mnc", substring);
    }
    
    protected void setMraidFlag(final boolean b) {
        if (b) {
            this.addParam("mr", "1");
        }
    }
    
    protected void setNetworkType(final int n) {
        switch (n) {
            default: {
                this.addParam("ct", AdUrlGenerator$MoPubNetworkType.UNKNOWN);
            }
            case 9: {
                this.addParam("ct", AdUrlGenerator$MoPubNetworkType.ETHERNET);
            }
            case 1: {
                this.addParam("ct", AdUrlGenerator$MoPubNetworkType.WIFI);
            }
            case 0:
            case 2:
            case 3:
            case 4:
            case 5: {
                this.addParam("ct", AdUrlGenerator$MoPubNetworkType.MOBILE);
            }
        }
    }
    
    protected void setOrientation(final int n) {
        String s = "u";
        if (n == 1) {
            s = "p";
        }
        else if (n == 2) {
            s = "l";
        }
        else if (n == 3) {
            s = "s";
        }
        this.addParam("o", s);
    }
    
    protected void setSdkVersion(final String s) {
        this.addParam("nv", s);
    }
    
    protected void setTimezone(final String s) {
        this.addParam("z", s);
    }
    
    protected void setTwitterAppInstalledFlag() {
        if (AdUrlGenerator.sTwitterAppInstalledStatus == AdUrlGenerator$TwitterAppInstalledStatus.UNKNOWN) {
            AdUrlGenerator.sTwitterAppInstalledStatus = this.getTwitterAppInstallStatus();
        }
        if (AdUrlGenerator.sTwitterAppInstalledStatus == AdUrlGenerator$TwitterAppInstalledStatus.INSTALLED) {
            this.addParam("ts", "1");
        }
    }
    
    public AdUrlGenerator withAdUnitId(final String mAdUnitId) {
        this.mAdUnitId = mAdUnitId;
        return this;
    }
    
    public AdUrlGenerator withFacebookSupported(final boolean mFacebookSupportEnabled) {
        this.mFacebookSupportEnabled = mFacebookSupportEnabled;
        return this;
    }
    
    public AdUrlGenerator withKeywords(final String mKeywords) {
        this.mKeywords = mKeywords;
        return this;
    }
    
    public AdUrlGenerator withLocation(final Location mLocation) {
        this.mLocation = mLocation;
        return this;
    }
}
