// 
// Decompiled by Procyon v0.5.30
// 

package com.inmobi.commons.metric;

import java.io.IOException;
import com.inmobi.commons.internal.Log;
import com.inmobi.commons.internal.FileOperations;
import com.inmobi.commons.internal.InternalSDKUtil;
import java.util.concurrent.atomic.AtomicBoolean;

public class Storage
{
    MetricConfigParams a;
    private String b;
    private String c;
    private String d;
    private int e;
    private Storage$PreProcessor f;
    private Queuer g;
    private long h;
    private long i;
    private AtomicBoolean j;
    private AtomicBoolean k;
    private Logger$MetricsCallback l;
    
    public Storage(final int e, final String s, final Queuer g, final MetricConfigParams a) {
        this.b = "inmobi.cache.data";
        this.c = "inmobi.cache.data.events.number";
        this.d = "inmobi.cache.data.events.timestamp";
        this.e = 0;
        this.f = null;
        this.g = null;
        this.a = null;
        this.h = -1L;
        this.i = -1L;
        this.j = new AtomicBoolean(false);
        this.k = new AtomicBoolean(false);
        this.l = null;
        this.a = a;
        this.g = g;
        this.e = e;
        this.b = this.b + "." + s;
        this.c = this.c + "." + s;
        this.d = this.d + "." + s;
    }
    
    public Storage(final int n, final String s, final Queuer queuer, final MetricConfigParams metricConfigParams, final Storage$PreProcessor f) {
        this(n, s, queuer, metricConfigParams);
        this.f = f;
    }
    
    private void a() {
        try {
            FileOperations.writeStringToFile(InternalSDKUtil.getContext(), this.c, new StringBuilder().append(this.h).toString(), false);
            FileOperations.writeStringToFile(InternalSDKUtil.getContext(), this.d, new StringBuilder().append(this.i).toString(), false);
        }
        catch (Exception ex) {
            this.h = 0L;
        }
    }
    
    public long getEvents() {
        return this.h;
    }
    
    public long getTimestamp() {
        return this.i;
    }
    
    public String readLocalCache() {
        try {
            return FileOperations.readFileAsString(InternalSDKUtil.getContext(), this.b);
        }
        catch (Exception ex) {
            Log.internal("[InMobi]-[AdTracker]-4.4.3", "Unable to read metric info.");
            return "null,";
        }
    }
    
    public void readNumberOfEventsAndTimeStampFromPersistent() {
        if (this.h == -1L) {
            while (true) {
                try {
                    this.h = Long.parseLong(FileOperations.readFileAsString(InternalSDKUtil.getContext(), this.c));
                    this.i = Long.parseLong(FileOperations.readFileAsString(InternalSDKUtil.getContext(), this.d));
                    if (this.i == -1L) {
                        this.i = System.currentTimeMillis() / 1000L;
                        this.a();
                    }
                }
                catch (Exception ex) {
                    this.h = 0L;
                    continue;
                }
                break;
            }
        }
    }
    
    public void resetFile() {
        try {
            FileOperations.writeStringToFile(InternalSDKUtil.getContext(), this.b, "", false);
            this.h = 0L;
            this.i = System.currentTimeMillis() / 1000L;
            this.a();
        }
        catch (IOException ex) {
            Log.internal("[InMobi]-[AdTracker]-4.4.3", "Someting went wrong while saving metrics log to persistent storage", ex);
        }
    }
    
    public void saveLocalCache() {
        if (!this.j.compareAndSet(false, true)) {
            return;
        }
        if (this.l != null) {
            this.l.movedMetricDataToFileMemory(this.b);
        }
        while (true) {
            try {
                FileOperations.writeStringToFile(InternalSDKUtil.getContext(), this.b, this.g.get(), true);
                this.h += this.g.a();
                this.g.reset();
                this.a();
                this.j.set(false);
                try {
                    synchronized (this.j) {
                        this.j.notify();
                    }
                }
                catch (Exception ex) {
                    Log.internal("[InMobi]-[AdTracker]-4.4.3", "Error saving local cache", ex);
                }
            }
            catch (IOException ex2) {
                Log.internal("[InMobi]-[AdTracker]-4.4.3", "Someting went wrong while saving metrics log to persistent storage", ex2);
                continue;
            }
            break;
        }
    }
    
    public void saveToLatest() {
        this.saveLocalCache();
    }
    
    public void sendFile() {
        // 
        // This method could not be decompiled.
        // 
        // Original Bytecode:
        // 
        //     0: aload_0        
        //     1: getfield        com/inmobi/commons/metric/Storage.k:Ljava/util/concurrent/atomic/AtomicBoolean;
        //     4: iconst_0       
        //     5: iconst_1       
        //     6: invokevirtual   java/util/concurrent/atomic/AtomicBoolean.compareAndSet:(ZZ)Z
        //     9: ifne            13
        //    12: return         
        //    13: aload_0        
        //    14: getfield        com/inmobi/commons/metric/Storage.j:Ljava/util/concurrent/atomic/AtomicBoolean;
        //    17: iconst_0       
        //    18: iconst_1       
        //    19: invokevirtual   java/util/concurrent/atomic/AtomicBoolean.compareAndSet:(ZZ)Z
        //    22: ifne            65
        //    25: aload_0        
        //    26: getfield        com/inmobi/commons/metric/Storage.j:Ljava/util/concurrent/atomic/AtomicBoolean;
        //    29: astore          14
        //    31: aload           14
        //    33: monitorenter   
        //    34: aload_0        
        //    35: getfield        com/inmobi/commons/metric/Storage.j:Ljava/util/concurrent/atomic/AtomicBoolean;
        //    38: invokevirtual   java/lang/Object.wait:()V
        //    41: aload           14
        //    43: monitorexit    
        //    44: goto            13
        //    47: astore          15
        //    49: aload           14
        //    51: monitorexit    
        //    52: aload           15
        //    54: athrow         
        //    55: astore          13
        //    57: ldc             "[InMobi]-[AdTracker]-4.4.3"
        //    59: ldc             "Unable to get lock for reading file before sending metric data"
        //    61: invokestatic    com/inmobi/commons/internal/Log.internal:(Ljava/lang/String;Ljava/lang/String;)V
        //    64: return         
        //    65: aload_0        
        //    66: getfield        com/inmobi/commons/metric/Storage.l:Lcom/inmobi/commons/metric/Logger$MetricsCallback;
        //    69: ifnull          88
        //    72: aload_0        
        //    73: getfield        com/inmobi/commons/metric/Storage.l:Lcom/inmobi/commons/metric/Logger$MetricsCallback;
        //    76: aload_0        
        //    77: getfield        com/inmobi/commons/metric/Storage.a:Lcom/inmobi/commons/metric/MetricConfigParams;
        //    80: invokevirtual   com/inmobi/commons/metric/MetricConfigParams.getUrl:()Ljava/lang/String;
        //    83: invokeinterface com/inmobi/commons/metric/Logger$MetricsCallback.reportingStartedWithRequest:(Ljava/lang/String;)V
        //    88: ldc             "[InMobi]-[AdTracker]-4.4.3"
        //    90: new             Ljava/lang/StringBuilder;
        //    93: dup            
        //    94: ldc             "Sending "
        //    96: invokespecial   java/lang/StringBuilder.<init>:(Ljava/lang/String;)V
        //    99: aload_0        
        //   100: getfield        com/inmobi/commons/metric/Storage.h:J
        //   103: invokevirtual   java/lang/StringBuilder.append:(J)Ljava/lang/StringBuilder;
        //   106: ldc             " events to server.."
        //   108: invokevirtual   java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
        //   111: invokevirtual   java/lang/StringBuilder.toString:()Ljava/lang/String;
        //   114: invokestatic    com/inmobi/commons/internal/Log.internal:(Ljava/lang/String;Ljava/lang/String;)V
        //   117: aload_0        
        //   118: invokevirtual   com/inmobi/commons/metric/Storage.readLocalCache:()Ljava/lang/String;
        //   121: astore          5
        //   123: new             Lorg/json/JSONObject;
        //   126: dup            
        //   127: invokespecial   org/json/JSONObject.<init>:()V
        //   130: astore          6
        //   132: invokestatic    com/inmobi/commons/internal/InternalSDKUtil.getContext:()Landroid/content/Context;
        //   135: aconst_null    
        //   136: invokestatic    com/inmobi/commons/uid/UIDUtil.getMap:(Landroid/content/Context;Lcom/inmobi/commons/uid/UID;)Ljava/util/Map;
        //   139: aload           6
        //   141: invokestatic    com/inmobi/commons/uid/UIDUtil.bindToEncodedJSON:(Ljava/util/Map;Lorg/json/JSONObject;)V
        //   144: invokestatic    java/util/Calendar.getInstance:()Ljava/util/Calendar;
        //   147: astore          7
        //   149: aload           6
        //   151: ldc             "tz"
        //   153: aload           7
        //   155: bipush          15
        //   157: invokevirtual   java/util/Calendar.get:(I)I
        //   160: invokevirtual   org/json/JSONObject.put:(Ljava/lang/String;I)Lorg/json/JSONObject;
        //   163: pop            
        //   164: aload           6
        //   166: ldc             "ts"
        //   168: aload           7
        //   170: invokevirtual   java/util/Calendar.getTimeInMillis:()J
        //   173: invokevirtual   org/json/JSONObject.put:(Ljava/lang/String;J)Lorg/json/JSONObject;
        //   176: pop            
        //   177: aload           6
        //   179: ldc             "product"
        //   181: aload_0        
        //   182: getfield        com/inmobi/commons/metric/Storage.e:I
        //   185: invokevirtual   org/json/JSONObject.put:(Ljava/lang/String;I)Lorg/json/JSONObject;
        //   188: pop            
        //   189: aload           6
        //   191: ldc             "payload"
        //   193: new             Lorg/json/JSONArray;
        //   196: dup            
        //   197: new             Ljava/lang/StringBuilder;
        //   200: dup            
        //   201: ldc             "["
        //   203: invokespecial   java/lang/StringBuilder.<init>:(Ljava/lang/String;)V
        //   206: aload           5
        //   208: iconst_0       
        //   209: iconst_m1      
        //   210: aload           5
        //   212: invokevirtual   java/lang/String.length:()I
        //   215: iadd           
        //   216: invokevirtual   java/lang/String.substring:(II)Ljava/lang/String;
        //   219: invokevirtual   java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
        //   222: ldc             "]"
        //   224: invokevirtual   java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
        //   227: invokevirtual   java/lang/StringBuilder.toString:()Ljava/lang/String;
        //   230: invokespecial   org/json/JSONArray.<init>:(Ljava/lang/String;)V
        //   233: invokevirtual   org/json/JSONObject.put:(Ljava/lang/String;Ljava/lang/Object;)Lorg/json/JSONObject;
        //   236: pop            
        //   237: aload_0        
        //   238: getfield        com/inmobi/commons/metric/Storage.f:Lcom/inmobi/commons/metric/Storage$PreProcessor;
        //   241: ifnull          257
        //   244: aload_0        
        //   245: getfield        com/inmobi/commons/metric/Storage.f:Lcom/inmobi/commons/metric/Storage$PreProcessor;
        //   248: aload           6
        //   250: invokeinterface com/inmobi/commons/metric/Storage$PreProcessor.process:(Lorg/json/JSONObject;)Lorg/json/JSONObject;
        //   255: astore          6
        //   257: aload           6
        //   259: invokevirtual   org/json/JSONObject.toString:()Ljava/lang/String;
        //   262: astore          12
        //   264: ldc             "[InMobi]-[AdTracker]-4.4.3"
        //   266: new             Ljava/lang/StringBuilder;
        //   269: dup            
        //   270: ldc_w           "sending "
        //   273: invokespecial   java/lang/StringBuilder.<init>:(Ljava/lang/String;)V
        //   276: aload           12
        //   278: invokevirtual   java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
        //   281: ldc_w           " to url :"
        //   284: invokevirtual   java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
        //   287: aload_0        
        //   288: getfield        com/inmobi/commons/metric/Storage.a:Lcom/inmobi/commons/metric/MetricConfigParams;
        //   291: invokevirtual   com/inmobi/commons/metric/MetricConfigParams.getUrl:()Ljava/lang/String;
        //   294: invokevirtual   java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
        //   297: invokevirtual   java/lang/StringBuilder.toString:()Ljava/lang/String;
        //   300: invokestatic    com/inmobi/commons/internal/Log.internal:(Ljava/lang/String;Ljava/lang/String;)V
        //   303: aload_0        
        //   304: getfield        com/inmobi/commons/metric/Storage.a:Lcom/inmobi/commons/metric/MetricConfigParams;
        //   307: invokevirtual   com/inmobi/commons/metric/MetricConfigParams.getUrl:()Ljava/lang/String;
        //   310: aload           12
        //   312: invokestatic    com/inmobi/commons/metric/MetricEndPoint.sendData:(Ljava/lang/String;Ljava/lang/String;)V
        //   315: ldc             "[InMobi]-[AdTracker]-4.4.3"
        //   317: new             Ljava/lang/StringBuilder;
        //   320: dup            
        //   321: ldc_w           "data sent successfully to url :"
        //   324: invokespecial   java/lang/StringBuilder.<init>:(Ljava/lang/String;)V
        //   327: aload_0        
        //   328: getfield        com/inmobi/commons/metric/Storage.a:Lcom/inmobi/commons/metric/MetricConfigParams;
        //   331: invokevirtual   com/inmobi/commons/metric/MetricConfigParams.getUrl:()Ljava/lang/String;
        //   334: invokevirtual   java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
        //   337: invokevirtual   java/lang/StringBuilder.toString:()Ljava/lang/String;
        //   340: invokestatic    com/inmobi/commons/internal/Log.internal:(Ljava/lang/String;Ljava/lang/String;)V
        //   343: aload_0        
        //   344: invokevirtual   com/inmobi/commons/metric/Storage.resetFile:()V
        //   347: aload_0        
        //   348: getfield        com/inmobi/commons/metric/Storage.l:Lcom/inmobi/commons/metric/Logger$MetricsCallback;
        //   351: ifnull          363
        //   354: aload_0        
        //   355: getfield        com/inmobi/commons/metric/Storage.l:Lcom/inmobi/commons/metric/Logger$MetricsCallback;
        //   358: invokeinterface com/inmobi/commons/metric/Logger$MetricsCallback.reportingSuccess:()V
        //   363: aload_0        
        //   364: getfield        com/inmobi/commons/metric/Storage.j:Ljava/util/concurrent/atomic/AtomicBoolean;
        //   367: iconst_0       
        //   368: invokevirtual   java/util/concurrent/atomic/AtomicBoolean.set:(Z)V
        //   371: aload_0        
        //   372: getfield        com/inmobi/commons/metric/Storage.j:Ljava/util/concurrent/atomic/AtomicBoolean;
        //   375: astore_3       
        //   376: aload_3        
        //   377: monitorenter   
        //   378: aload_0        
        //   379: getfield        com/inmobi/commons/metric/Storage.j:Ljava/util/concurrent/atomic/AtomicBoolean;
        //   382: invokevirtual   java/lang/Object.notify:()V
        //   385: aload_3        
        //   386: monitorexit    
        //   387: aload_0        
        //   388: getfield        com/inmobi/commons/metric/Storage.k:Ljava/util/concurrent/atomic/AtomicBoolean;
        //   391: iconst_0       
        //   392: invokevirtual   java/util/concurrent/atomic/AtomicBoolean.set:(Z)V
        //   395: return         
        //   396: astore_1       
        //   397: ldc             "[InMobi]-[AdTracker]-4.4.3"
        //   399: ldc_w           "Unable to send data"
        //   402: invokestatic    com/inmobi/commons/internal/Log.internal:(Ljava/lang/String;Ljava/lang/String;)V
        //   405: aload_0        
        //   406: getfield        com/inmobi/commons/metric/Storage.l:Lcom/inmobi/commons/metric/Logger$MetricsCallback;
        //   409: ifnull          363
        //   412: aload_0        
        //   413: getfield        com/inmobi/commons/metric/Storage.l:Lcom/inmobi/commons/metric/Logger$MetricsCallback;
        //   416: invokeinterface com/inmobi/commons/metric/Logger$MetricsCallback.reportingFailure:()V
        //   421: goto            363
        //   424: astore          4
        //   426: aload_3        
        //   427: monitorexit    
        //   428: aload           4
        //   430: athrow         
        //   431: astore_2       
        //   432: ldc             "[InMobi]-[AdTracker]-4.4.3"
        //   434: ldc_w           "Unable to lock file."
        //   437: invokestatic    com/inmobi/commons/internal/Log.internal:(Ljava/lang/String;Ljava/lang/String;)V
        //   440: goto            387
        //    Exceptions:
        //  Try           Handler
        //  Start  End    Start  End    Type                 
        //  -----  -----  -----  -----  ---------------------
        //  25     34     55     65     Ljava/lang/Exception;
        //  34     44     47     55     Any
        //  49     55     55     65     Ljava/lang/Exception;
        //  88     257    396    424    Ljava/lang/Exception;
        //  257    363    396    424    Ljava/lang/Exception;
        //  371    378    431    443    Ljava/lang/Exception;
        //  378    387    424    431    Any
        //  426    431    431    443    Ljava/lang/Exception;
        // 
        // The error that occurred was:
        // 
        // java.lang.IllegalStateException: Expression is linked from several locations: Label_0387:
        //     at com.strobel.decompiler.ast.Error.expressionLinkedFromMultipleLocations(Error.java:27)
        //     at com.strobel.decompiler.ast.AstOptimizer.mergeDisparateObjectInitializations(AstOptimizer.java:2592)
        //     at com.strobel.decompiler.ast.AstOptimizer.optimize(AstOptimizer.java:235)
        //     at com.strobel.decompiler.ast.AstOptimizer.optimize(AstOptimizer.java:42)
        //     at com.strobel.decompiler.languages.java.ast.AstMethodBodyBuilder.createMethodBody(AstMethodBodyBuilder.java:214)
        //     at com.strobel.decompiler.languages.java.ast.AstMethodBodyBuilder.createMethodBody(AstMethodBodyBuilder.java:99)
        //     at com.strobel.decompiler.languages.java.ast.AstBuilder.createMethodBody(AstBuilder.java:757)
        //     at com.strobel.decompiler.languages.java.ast.AstBuilder.createMethod(AstBuilder.java:655)
        //     at com.strobel.decompiler.languages.java.ast.AstBuilder.addTypeMembers(AstBuilder.java:532)
        //     at com.strobel.decompiler.languages.java.ast.AstBuilder.createTypeCore(AstBuilder.java:499)
        //     at com.strobel.decompiler.languages.java.ast.AstBuilder.createTypeNoCache(AstBuilder.java:141)
        //     at com.strobel.decompiler.languages.java.ast.AstBuilder.createType(AstBuilder.java:130)
        //     at com.strobel.decompiler.languages.java.ast.AstBuilder.addType(AstBuilder.java:105)
        //     at com.strobel.decompiler.languages.java.JavaLanguage.buildAst(JavaLanguage.java:71)
        //     at com.strobel.decompiler.languages.java.JavaLanguage.decompileType(JavaLanguage.java:59)
        //     at com.strobel.decompiler.DecompilerDriver.decompileType(DecompilerDriver.java:317)
        //     at com.strobel.decompiler.DecompilerDriver.decompileJar(DecompilerDriver.java:238)
        //     at com.strobel.decompiler.DecompilerDriver.main(DecompilerDriver.java:123)
        // 
        throw new IllegalStateException("An error occurred while decompiling this method.");
    }
    
    public void setCallback(final Logger$MetricsCallback l) {
        this.l = l;
    }
    
    public void setPreprocessor(final Storage$PreProcessor f) {
        this.f = f;
    }
}
