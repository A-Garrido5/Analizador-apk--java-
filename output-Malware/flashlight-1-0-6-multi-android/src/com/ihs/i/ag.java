// 
// Decompiled by Procyon v0.5.30
// 

package com.ihs.i;

import java.util.HashMap;

public final class ag extends m
{
    protected b k;
    protected b l;
    
    public ag() {
        this.l = new b() {
            @Override
            public final void a() {
                if (ag.this.k != null) {
                    ag.this.k.a();
                }
            }
            
            @Override
            public final void a(final int n, final String s) {
                if (ag.this.k != null) {
                    ag.this.k.a(n, s);
                }
            }
            
            @Override
            public final void a(final String s) {
                try {
                    final ag a = ag.this;
                    final HashMap b = ag.b(s);
                    final String s2 = b.get("header-message-id");
                    if (s2 != null) {
                        ag.this.c(s2);
                    }
                    final String s3 = b.get("body");
                    if (ag.this.k != null && s3 != null) {
                        ag.this.k.a(s3);
                    }
                }
                catch (Exception ex) {
                    ex.printStackTrace();
                }
            }
            
            @Override
            public final void a(final byte[] array) {
                while (true) {
                    while (true) {
                        int n = 0;
                        Label_0177: {
                            try {
                                Boolean b = false;
                                n = 0;
                                int n2;
                                if (n >= array.length) {
                                    n2 = -1;
                                }
                                else {
                                    if (array[n] != 10) {
                                        b = false;
                                        break Label_0177;
                                    }
                                    if (!b) {
                                        b = true;
                                        break Label_0177;
                                    }
                                    n2 = n - 1;
                                }
                                final byte[] array2 = new byte[n2];
                                final byte[] array3 = new byte[-2 + (array.length - n2)];
                                System.arraycopy(array, 0, array2, 0, n2);
                                System.arraycopy(array, n2 + 2, array3, 0, array3.length);
                                final ag a = ag.this;
                                final String s = ag.b(new String(array2)).get("header-message-id");
                                if (s != null) {
                                    ag.this.c(s);
                                }
                                if (ag.this.k != null) {
                                    ag.this.k.a(array3);
                                    return;
                                }
                            }
                            catch (Exception ex) {
                                ex.printStackTrace();
                            }
                            break;
                        }
                        ++n;
                        continue;
                    }
                }
            }
            
            @Override
            public final void b() {
                if (ag.this.k != null) {
                    ag.this.k.b();
                }
            }
        };
    }
    
    protected static HashMap b(final String s) {
        final HashMap<String, String> hashMap = new HashMap<String, String>();
        int n = s.indexOf("\n\n");
        if (n > 0) {
            hashMap.put("body", s.substring(n + 2));
        }
        else {
            n = s.length();
        }
        final String[] split = s.substring(0, n).split("\n");
        String s2 = null;
        String trim;
        for (int i = 0; i < split.length; ++i, s2 = trim) {
            trim = split[i].trim();
            if (s2 == null && trim != "") {
                hashMap.put("command", trim);
            }
            else {
                final int index = trim.indexOf(":");
                if (index > 0) {
                    hashMap.put("header-" + trim.substring(0, index), trim.substring(index + 1));
                }
                trim = s2;
            }
        }
        return hashMap;
    }
    
    @Override
    public final void a(final String s, final String[] h, final l l, final af af) {
        this.a = com.ihs.i.c.b;
        this.k = (b)l;
        this.i = this.l;
        if (s.startsWith("http://") || s.startsWith("https://")) {
            this.h = h;
            this.j = new af(af);
            new ah(this).execute((Object[])new String[] { s });
            return;
        }
        super.a(s, h, this.l, af);
    }
    
    @Override
    public final void b() {
        super.b();
        if (this.f == null) {
            return;
        }
        try {
            this.f.socket().close();
        }
        catch (Exception ex) {
            ex.printStackTrace();
        }
    }
    
    protected final void c(final String s) {
        final StringBuffer sb = new StringBuffer();
        sb.append("ack\n");
        sb.append("id: " + s);
        sb.append("\n\n");
        this.a(sb.toString());
    }
}
