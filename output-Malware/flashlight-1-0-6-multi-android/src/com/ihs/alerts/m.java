// 
// Decompiled by Procyon v0.5.30
// 

package com.ihs.alerts;

import com.ihs.g.e;
import java.util.Locale;
import java.util.Date;
import com.ihs.h.a;
import com.ihs.g.c;
import java.util.Random;
import com.ihs.g.d;
import java.util.ArrayList;
import java.util.Map;
import java.util.List;

public final class m extends j
{
    private static String a;
    private static String b;
    private static m e;
    private int c;
    private List d;
    
    static {
        m.a = null;
        m.b = null;
    }
    
    public static m a() {
        synchronized (m.class) {
            if (m.e == null) {
                m.e = new m();
            }
            return m.e;
        }
    }
    
    private Map a(final n n) {
        final ArrayList<Map<?, String>> list = new ArrayList<Map<?, String>>();
        int i = 0;
        int n2 = 0;
        while (i < this.d.size()) {
            final Map<K, String> map = this.d.get(i);
            if (a(map, n)) {
                list.add(map);
                n2 += com.ihs.g.d.e(map, "Weight");
            }
            ++i;
        }
        Object o;
        if (list.size() == 0 || n2 == 0) {
            o = null;
        }
        else {
            final int nextInt = new Random().nextInt(n2);
            final int a = com.ihs.g.d.a(list.get(0), new String[] { "Weight" });
            int n3 = 0;
            for (int n4 = a; n3 < -1 + list.size() && nextInt >= n4; n4 += com.ihs.g.d.e(list.get(n3 + 1), "Weight"), ++n3) {}
            o = list.get(n3);
            if (o != null) {
                m.b = ((Map<K, String>)o).get("Market");
                m.a = ((Map<K, String>)o).get("URLScheme");
                return (Map)o;
            }
        }
        return (Map)o;
    }
    
    private static boolean a(final Map map, final n n) {
        if (map != null) {
            c.a("iHSAlertLibrary", "promote alert data is " + map);
            while (true) {
                String country = null;
                Label_0246: {
                    try {
                        final boolean f = d.f(map, "AllowFirstLaunchPromote");
                        if (com.ihs.h.a.a().c() && !f) {
                            return false;
                        }
                        final boolean f2 = d.f(map, "AppStart");
                        final boolean f3 = d.f(map, "AppEnd");
                        if ((n != n.a || !f2) && (n != n.b || !f3)) {
                            return false;
                        }
                        final Date a = d.a(map, new Date(0L), "DateStart");
                        final Date a2 = d.a(map, new Date(0L), "DateEnd");
                        final Date date = new Date();
                        if (date.compareTo(a) < 0 || date.compareTo(a2) > 0) {
                            return false;
                        }
                        country = Locale.getDefault().getCountry();
                        final List c = d.c(map, "RegionFilter");
                        if (c != null && !c.contains(country)) {
                            com.ihs.g.c.a("iHSAlertLibrary", "regionfilterkey");
                            return false;
                        }
                        break Label_0246;
                    }
                    catch (Exception ex) {
                        ex.printStackTrace();
                    }
                    c.a("iHSAlertLibrary", "isAlertEligibleToShow return true");
                    return true;
                }
                final List c2 = d.c(map, "RegionException");
                if (c2 != null && c2.contains(country)) {
                    c.a("iHSAlertLibrary", "regionexceptionkey");
                    return false;
                }
                if (com.ihs.g.a.a(com.ihs.g.a.a, d.b(map, "URLScheme"))) {
                    c.a("iHSAlertLibrary", "installed app");
                    return false;
                }
                if (!com.ihs.g.e.a().b(com.ihs.g.a.a, d.b(map, "Market"))) {
                    c.a("iHSAlertLibrary", "not market existed");
                    return false;
                }
                continue;
            }
        }
        return false;
    }
    
    public static void b() {
        com.ihs.g.e.a().a(com.ihs.g.a.b, m.b, m.a);
    }
    
    public final void a(final Map map) {
        this.d = null;
        final Map d = com.ihs.g.d.d(map, "PromoteAlert");
        if (d != null) {
            this.c = com.ihs.g.d.e(d, "MinimumShowInterval");
            this.d = com.ihs.g.d.c(d, "Alerts");
        }
        if (this.d == null) {
            this.d = new ArrayList();
            this.c = 0;
        }
    }
    
    public final void c() {
        if (this.d != null) {
            this.d.clear();
        }
    }
    
    @Override
    protected final Object clone() {
        throw new CloneNotSupportedException();
    }
    
    public final h d() {
        final n a = n.a;
        final int compareTo = new Date(new Date(com.ihs.g.j.d("PromoteAlertLastShownDate")).getTime() + 1000 * (60 * this.c)).compareTo(new Date());
        int n = 0;
        Label_0056: {
            if (compareTo <= 0) {
                if (a == com.ihs.alerts.n.b) {
                    final boolean b = com.ihs.alerts.d.a().b;
                    n = 0;
                    if (b) {
                        break Label_0056;
                    }
                }
                n = 1;
            }
        }
        if (n != 0) {
            final Map a2 = this.a(com.ihs.alerts.n.a);
            if (a2 != null) {
                com.ihs.a.d.a();
                com.ihs.a.d.c("HSPromoteAlert_Showed");
                com.ihs.a.d.a().a("iHandyAlerts_Events", "iHandyAlerts_PromoteAlert_Showed", com.ihs.g.a.a.getPackageName());
                final h a3 = j.a(a2, com.ihs.alerts.e.e);
                if (a3 != null) {
                    com.ihs.g.j.a("PromoteAlertLastShownDate", new Date().getTime());
                }
                return a3;
            }
        }
        return null;
    }
}
