// 
// Decompiled by Procyon v0.5.30
// 

package com.ihs.f.a;

import java.io.InputStream;
import android.content.Context;
import java.io.IOException;
import java.util.TimerTask;
import com.ihs.g.i;
import android.text.TextUtils;
import com.ihs.g.j;
import java.util.List;
import android.content.pm.ApplicationInfo;
import java.util.Locale;
import java.util.TimeZone;
import java.util.Iterator;
import com.ihs.g.d;
import java.util.HashMap;
import java.util.Map;
import java.util.Timer;
import java.util.ArrayList;

public final class c implements b
{
    private static c i;
    private ArrayList a;
    private Timer b;
    private String c;
    private Object d;
    private boolean e;
    private Map f;
    private Map g;
    private a h;
    
    static {
        c.i = new c();
    }
    
    private c() {
        this.a = new ArrayList();
        this.b = null;
        this.d = new Object();
        this.e = false;
        this.g = new HashMap();
    }
    
    public static c a() {
        return c.i;
    }
    
    private void a(final Map f) {
        synchronized (this.d) {
            this.f = f;
            if (com.ihs.h.a.a().e()) {
                final HashMap hashMap = this.f.get(com.ihs.e.a.r);
                com.ihs.g.d.a(hashMap, this.f.get("DataTest"));
                com.ihs.g.d.a(hashMap, this.f.get("DataTest" + com.ihs.h.a.a().f()));
            }
        }
    }
    
    private void a(final boolean b) {
        if (this.a.isEmpty()) {
            return;
        }
        while (true) {
            while (true) {
                final Iterator<com.ihs.f.a.d> iterator;
                synchronized (this.a) {
                    iterator = (Iterator<com.ihs.f.a.d>)this.a.iterator();
                    if (!iterator.hasNext()) {
                        return;
                    }
                }
                iterator.next().b(b);
                continue;
            }
        }
    }
    
    private int b(final String... array) {
        return com.ihs.g.d.a(this.f(), array);
    }
    
    public static c b() {
        return c.i;
    }
    
    static /* synthetic */ void b(final c c) {
        c.b = null;
    }
    
    static /* synthetic */ void c(final c c) {
        c.a(false);
    }
    
    private Map f() {
        return com.ihs.g.d.d(this.f, com.ihs.e.a.r);
    }
    
    private void g() {
        this.g.clear();
        if (this.d() == null) {
            this.e = false;
        }
        else {
            final List c = com.ihs.g.d.c(this.f(), "RestrictedUser");
            if (c == null || c.size() <= 0) {
                this.e = false;
                return;
            }
            final List installedApplications = com.ihs.g.a.a.getPackageManager().getInstalledApplications(8192);
            for (final Map next : c) {
                final Map map = next;
                boolean e;
                if (map.isEmpty()) {
                    e = false;
                }
                else {
                    final String value = String.valueOf(TimeZone.getDefault().getRawOffset() / 3600000);
                    final String b = com.ihs.g.d.b(map, "TimeZone");
                    final boolean b2 = b == null || value.equalsIgnoreCase(b);
                    final String string = String.valueOf(Locale.getDefault().getLanguage()) + "_" + Locale.getDefault().getCountry();
                    final String b3 = com.ihs.g.d.b(map, "RegionFormat");
                    e = ((b3 == null || string.equalsIgnoreCase(b3)) && b2);
                    final List c2 = com.ihs.g.d.c(map, "UrlScheme");
                    if (c2 != null && !c2.isEmpty()) {
                        final Iterator<String> iterator2 = c2.iterator();
                        int n = 0;
                    Label_0358:
                        while (iterator2.hasNext()) {
                            final String next2 = iterator2.next();
                            final Iterator<ApplicationInfo> iterator3 = installedApplications.iterator();
                            while (true) {
                                while (iterator3.hasNext()) {
                                    if (iterator3.next().packageName.equalsIgnoreCase(next2)) {
                                        n = 1;
                                        if (n != 0) {
                                            continue Label_0358;
                                        }
                                        break Label_0358;
                                    }
                                }
                                n = 0;
                                continue;
                            }
                        }
                        if (n == 0) {
                            e = false;
                        }
                    }
                }
                this.e = e;
                if (this.e) {
                    this.g.put("Description", com.ihs.g.d.b(next, "Description"));
                    com.ihs.g.c.a("restricted user info is " + this.g.toString());
                }
            }
        }
    }
    
    private void h() {
        j.a("MaxOSVersionOfHomeKeyDetect", this.b("System", "MaxOSVersionOfHomeKeyDetect"));
        j.a("SessionEndTimeout", (long)(1000 * this.b("System", "SessionEndConfig", "Timeout")));
        j.a("SessionEndType", this.b("System", "SessionEndConfig", "EndType"));
    }
    
    public final String a(final String s, final String... array) {
        return com.ihs.g.d.a(this.f(), s, array);
    }
    
    public final String a(final String... array) {
        return com.ihs.g.d.b(this.f(), array);
    }
    
    @Override
    public final void a(final a a) {
        if (this.h != null) {
            final Map b = this.h.b();
            if (b != null) {
                boolean b2 = false;
                Label_0073: {
                    if (this.f != null) {
                        final boolean equals = b.equals(this.f);
                        b2 = false;
                        if (equals) {
                            break Label_0073;
                        }
                    }
                    this.a(b);
                    this.g();
                    com.ihs.c.b.a().a(new com.ihs.c.a(com.ihs.c.d.h));
                    b2 = true;
                }
                this.h();
                if (this.b != null) {
                    this.b.cancel();
                    this.b = null;
                    this.a(true);
                }
                if (b2 && !this.a.isEmpty()) {
                    while (true) {
                        while (true) {
                            final Iterator iterator;
                            synchronized (this.a) {
                                iterator = this.a.iterator();
                                if (!iterator.hasNext()) {
                                    return;
                                }
                            }
                            iterator.next().c();
                            continue;
                        }
                    }
                }
            }
        }
    }
    
    public final void a(final com.ihs.f.a.d d) {
        if (d == null) {
            return;
        }
        synchronized (this.a) {
            if (!this.a.contains(d)) {
                this.a.add(d);
            }
        }
    }
    
    @Override
    public final void a(final Exception ex) {
        if (this.b != null) {
            this.b.cancel();
            this.b = null;
            this.a(false);
        }
    }
    
    public final void a(final String s, final String c, final long n, final com.ihs.f.a.d d) {
        this.a(d);
        this.c = c;
        if (TextUtils.isEmpty((CharSequence)this.c)) {
            return;
        }
        final com.ihs.h.a a = com.ihs.h.a.a();
        while (true) {
            final boolean b;
            final Context a2;
            final String c2;
            Label_0149: {
                Label_0084: {
                    if (!a.c() && !a.d()) {
                        this.a(com.ihs.g.i.b(this.c));
                        break Label_0084;
                    }
                    b = com.ihs.g.b.b(this.c);
                    a2 = com.ihs.g.a.a;
                    c2 = this.c;
                    if (a2 != null && c2 != null) {
                        break Label_0149;
                    }
                    this.a(com.ihs.g.i.b(this.c));
                }
                this.h();
                this.g();
                this.h = new a(this.c, s, this);
                this.b = new Timer();
                try {
                    this.b.schedule(new TimerTask() {
                        @Override
                        public final void run() {
                            if (com.ihs.f.a.c.this.b != null) {
                                com.ihs.f.a.c.this.b.cancel();
                            }
                            com.ihs.f.a.c.b(com.ihs.f.a.c.this);
                            com.ihs.f.a.c.c(com.ihs.f.a.c.this);
                        }
                    }, 1000L * n);
                    return;
                }
                catch (Exception ex) {
                    ex.printStackTrace();
                    return;
                }
            }
            final InputStream e = com.ihs.g.b.e(a2, c2);
            if (e != null) {
                com.ihs.g.b.a(a2, c2, e, b);
                try {
                    e.close();
                }
                catch (IOException ex2) {
                    ex2.printStackTrace();
                }
            }
            continue;
        }
    }
    
    public final void b(final com.ihs.f.a.d d) {
        if (this.a.isEmpty() || d == null) {
            return;
        }
        synchronized (this.a) {
            this.a.remove(d);
        }
    }
    
    public final boolean c() {
        return this.e;
    }
    
    @Override
    protected final Object clone() {
        throw new CloneNotSupportedException();
    }
    
    public final Map d() {
        if (this.f == null) {
            this.a(com.ihs.g.i.a(this.c));
        }
        return this.f;
    }
    
    public final Map e() {
        return this.g;
    }
}
