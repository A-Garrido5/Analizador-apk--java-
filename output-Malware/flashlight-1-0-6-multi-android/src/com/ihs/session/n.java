// 
// Decompiled by Procyon v0.5.30
// 

package com.ihs.session;

import com.ihs.c.d;
import android.content.Intent;
import com.ihs.g.c;
import com.ihs.c.b;
import java.util.TimerTask;
import com.ihs.g.a;
import java.util.Timer;

public final class n
{
    private static final n a;
    private int b;
    private boolean c;
    private long d;
    private Timer e;
    private Timer f;
    private int g;
    private HomeKeyTracker h;
    private j i;
    
    static {
        a = new n();
    }
    
    private n() {
        this.b = 0;
        this.c = true;
        this.d = 0L;
        this.e = null;
        this.f = null;
        this.g = 0;
        this.i = j.a;
        this.h = new HomeKeyTracker(com.ihs.g.a.a);
    }
    
    public static n a() {
        return n.a;
    }
    
    private void a(final long n) {
        this.c();
        this.e = new Timer();
        try {
            this.e.schedule(new TimerTask() {
                @Override
                public final void run() {
                    com.ihs.session.a.a().a(System.currentTimeMillis());
                    com.ihs.c.b.a().a(new m(System.currentTimeMillis()));
                }
            }, n);
        }
        catch (Exception ex) {
            com.ihs.g.c.b("ihssession", ex.getMessage());
        }
    }
    
    static /* synthetic */ void a(final n n) {
        n.c = true;
    }
    
    private void b() {
        if (this.f != null) {
            this.f.cancel();
            this.f = null;
        }
    }
    
    private void c() {
        if (this.e != null) {
            this.e.cancel();
            this.e = null;
        }
    }
    
    private static void c(final String s) {
        final Intent intent = new Intent(s);
        intent.addCategory(com.ihs.g.a.a.getPackageName());
        com.ihs.g.a.a.sendBroadcast(intent);
    }
    
    private static long d() {
        long d = com.ihs.g.j.d("SessionEndTimeout");
        if (0L == d) {
            d = 600000L;
        }
        return d;
    }
    
    public final void a(final String s) {
        int n = 1;
        // monitorenter(this)
        Label_0008: {
            if (s != null) {
                try {
                    if (s.equalsIgnoreCase("create")) {
                        ++this.g;
                        break Label_0008;
                    }
                }
                finally {
                }
                // monitorexit(this)
                if (s.equalsIgnoreCase("destroy")) {
                    --this.g;
                    if (this.g <= 0) {
                        com.ihs.c.b.a().a(new com.ihs.c.a(com.ihs.c.d.a));
                        if (k.b == com.ihs.session.i.a()) {
                            this.i = j.b;
                            this.a(0L);
                        }
                    }
                }
                else if (s.equalsIgnoreCase("start")) {
                    this.b();
                    this.c();
                    if (this.b == 0) {
                        this.h.a();
                        if (this.c) {
                            c("com.ihs.app_in_foreground");
                            com.ihs.c.b.a().a(new com.ihs.c.a(com.ihs.c.d.c));
                            this.c = false;
                        }
                        int n2;
                        if (k.b == com.ihs.session.i.a()) {
                            n2 = n;
                        }
                        else {
                            n2 = 0;
                        }
                        int n3;
                        if (this.i != j.b && this.i != j.c) {
                            n3 = 0;
                        }
                        else {
                            n3 = n;
                        }
                        final int n4 = n3 & n2;
                        if (n4 == 0) {
                            final long d = d();
                            com.ihs.g.c.a("start session, the interval = " + d);
                            if (System.currentTimeMillis() <= d + this.d) {
                                n = 0;
                            }
                        }
                        else {
                            n = n4;
                        }
                        if (n != 0) {
                            com.ihs.session.a.a().b(0L);
                            com.ihs.c.b.a().a(new com.ihs.c.a(com.ihs.c.d.f));
                        }
                    }
                    ++this.b;
                    this.i = j.a;
                    com.ihs.g.c.a("ihssession", "start, activityCount = " + this.b);
                }
                else if (s.equalsIgnoreCase("stop")) {
                    --this.b;
                    com.ihs.g.c.a("ihssession", "stop, activityCount = " + this.b);
                    if (this.b <= 0) {
                        this.h.b();
                        this.b = 0;
                        this.d = System.currentTimeMillis();
                        this.b();
                        this.f = new Timer();
                        while (true) {
                            try {
                                this.f.schedule(new TimerTask() {
                                    @Override
                                    public final void run() {
                                        n.a(n.this);
                                        final n a = n.this;
                                        c("com.ihs.app_in_background");
                                        com.ihs.c.b.a().a(new com.ihs.c.a(com.ihs.c.d.d));
                                    }
                                }, 1000L);
                                if (this.h.c()) {
                                    com.ihs.c.b.a().a(new com.ihs.c.a(com.ihs.c.d.b));
                                    if (k.b == com.ihs.session.i.a()) {
                                        this.i = j.c;
                                        this.a(0L);
                                        break Label_0008;
                                    }
                                }
                            }
                            catch (Exception ex) {
                                com.ihs.g.c.b("ihssession", ex.getMessage());
                                continue;
                            }
                            break;
                        }
                        this.i = j.d;
                        final long d2 = d();
                        com.ihs.g.c.a("end session, the interval = " + d2);
                        this.a(d2);
                    }
                }
            }
        }
    }
    // monitorexit(this)
}
