// 
// Decompiled by Procyon v0.5.30
// 

package com.nexage.android.reports2;

import java.util.Iterator;
import org.json.JSONArray;
import org.json.JSONObject;
import com.nexage.android.internal.NexageLog;
import com.nexage.android.v2.TagInfo;
import java.util.UUID;
import com.nexage.android.NexageAdView;
import java.util.ArrayList;

public class AdService2
{
    private static final String TAG = "AdService2";
    String aGuid;
    AdClick adClick;
    AdDisplay adDisplay;
    final ArrayList adNetRequests;
    String buyer;
    final int cached;
    String json;
    NexageAdView m_AdView;
    boolean m_OkToReport;
    int m_ServiceID;
    public final String position;
    String pru;
    public boolean reported;
    int responseTime;
    public boolean restored;
    String source;
    int status;
    long timestamp;
    
    AdService2(final String position) {
        this.adNetRequests = new ArrayList();
        this.m_AdView = null;
        this.position = position;
        this.source = null;
        this.status = -1;
        this.timestamp = ReportManager.getTimestamp();
        this.cached = 0;
        this.responseTime = -1;
        this.aGuid = UUID.randomUUID().toString().replace("-", "");
    }
    
    public AdService2(final String s, final String aGuid) {
        this(s);
        this.aGuid = aGuid;
    }
    
    public void addAdNetRequest(final TagInfo tagInfo) {
        synchronized (this) {
            NexageLog.i("AdService2", "addAdNetRequest: " + tagInfo.adTag.tagId);
            if (this.status <= 0 && tagInfo.status == 1) {
                this.status = 1;
            }
            this.adNetRequests.add(new AdNetRequest(tagInfo));
        }
    }
    
    public String getAGuid() {
        return this.aGuid;
    }
    
    public NexageAdView getAdView() {
        return this.m_AdView;
    }
    
    public long getTimestamp() {
        return this.timestamp;
    }
    
    public void readyToReport() {
        this.m_OkToReport = true;
        this.m_AdView = null;
    }
    
    public void setAGuid(final String aGuid) {
        this.aGuid = aGuid;
    }
    
    public void setAdView(final NexageAdView adView) {
        this.m_AdView = adView;
    }
    
    public void setRTB(final String pru, final String buyer) {
        this.pru = pru;
        this.buyer = buyer;
    }
    
    JSONObject toJson() {
        synchronized (this) {
            final JSONObject jsonObject = new JSONObject();
            jsonObject.put("a", (Object)this.aGuid);
            jsonObject.put("ts", this.timestamp);
            jsonObject.put("zone", (Object)this.position);
            jsonObject.put("resp", this.responseTime);
            if (this.source != null) {
                jsonObject.put("source", (Object)this.source);
            }
            if (this.pru != null) {
                jsonObject.put("pru", (Object)this.pru);
                jsonObject.put("buyer", (Object)this.buyer);
            }
            if (!this.adNetRequests.isEmpty()) {
                final JSONArray jsonArray = new JSONArray();
                this.reported = true;
                final Iterator<AdNetRequest> iterator = (Iterator<AdNetRequest>)this.adNetRequests.iterator();
                int n = 0;
                while (iterator.hasNext()) {
                    final JSONObject json = iterator.next().toJson();
                    final int n2 = n + 1;
                    jsonArray.put(n, (Object)json);
                    n = n2;
                }
                jsonObject.put("adnet", (Object)jsonArray);
            }
            return jsonObject;
        }
    }
}
