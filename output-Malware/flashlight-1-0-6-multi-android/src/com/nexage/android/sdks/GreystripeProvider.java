// 
// Decompiled by Procyon v0.5.30
// 

package com.nexage.android.sdks;

import android.util.DisplayMetrics;
import android.view.ViewGroup$LayoutParams;
import android.widget.FrameLayout$LayoutParams;
import android.util.TypedValue;
import java.lang.reflect.InvocationHandler;
import java.lang.reflect.Proxy;
import com.nexage.android.NexageAdManager;
import android.location.Location;
import com.nexage.android.internal.NexageLog;
import android.os.Handler;
import android.content.Context;
import android.view.View;
import java.lang.reflect.Method;
import java.lang.reflect.Constructor;
import com.nexage.android.sdkmanager.SDKProvider;

public final class GreystripeProvider extends SDKProvider
{
    private static final String TAG = "GreystripeProvider";
    private Class GSAdListenerClass;
    private Class GSMobileBannerAdViewClass;
    private Constructor GSMobileBannerAdViewConstructor;
    private Class GSSdkInfoClass;
    private Method addListenerMethod;
    private Method getVersionMethod;
    private Object gsAdListenerProxy;
    private View gsMobileBannerAdView;
    private Method refreshMethod;
    private Method removeListenerMethod;
    private Method updateLocationMethod;
    
    public GreystripeProvider(final Context context, final Handler handler) {
        super(context, handler);
        NexageLog.d("GreystripeProvider", "entering constructor");
        try {
            this.GSSdkInfoClass = Class.forName("com.greystripe.sdk.GSSdkInfo");
            this.getVersionMethod = this.GSSdkInfoClass.getDeclaredMethod("getVersion", (Class[])new Class[0]);
            this.updateLocationMethod = this.GSSdkInfoClass.getDeclaredMethod("updateLocation", Location.class);
            this.GSAdListenerClass = Class.forName("com.greystripe.sdk.GSAdListener");
            this.GSMobileBannerAdViewClass = Class.forName("com.greystripe.sdk.GSMobileBannerAdView");
            this.GSMobileBannerAdViewConstructor = this.GSMobileBannerAdViewClass.getConstructor(Context.class, String.class);
            this.addListenerMethod = this.GSMobileBannerAdViewClass.getDeclaredMethod("addListener", this.GSAdListenerClass);
            this.refreshMethod = this.GSMobileBannerAdViewClass.getDeclaredMethod("refresh", (Class[])new Class[0]);
            this.removeListenerMethod = this.GSMobileBannerAdViewClass.getDeclaredMethod("removeListener", this.GSAdListenerClass);
            final String s = (String)this.getVersionMethod.invoke(null, new Object[0]);
            this.isSdkInitialized = true;
            NexageLog.d("GreystripeProvider", "SDK is initialized using Greystripe version " + s);
        }
        catch (Exception ex) {
            NexageLog.e("GreystripeProvider", "Failed to initialize Greystripe SDK.");
            NexageLog.e("GreystripeProvider", "Make sure that the Greystripe SDK JAR is in your classpath.");
            NexageLog.e("GreystripeProvider", "Failed here:", ex);
        }
    }
    
    @Override
    protected final void cancel() {
        try {
            if (this.gsMobileBannerAdView != null && this.gsAdListenerProxy != null) {
                this.removeListenerMethod.invoke(this.gsMobileBannerAdView, this.gsAdListenerProxy);
            }
        }
        catch (Exception ex) {
            NexageLog.e("GreystripeProvider", "loadAdView:", ex);
        }
    }
    
    @Override
    protected final View createAdView(final int n, final int n2, final String s) {
        NexageLog.d("GreystripeProvider", "createAdView");
        this.gsMobileBannerAdView = null;
        try {
            if (NexageAdManager.getLocationAwareness() != null) {
                this.updateLocationMethod.invoke(null, NexageAdManager.getLocationAwareness().getLocation());
            }
            this.gsMobileBannerAdView = this.GSMobileBannerAdViewConstructor.newInstance(this.context, s);
            if (this.gsMobileBannerAdView != null) {
                this.gsAdListenerProxy = Proxy.newProxyInstance(this.GSAdListenerClass.getClassLoader(), new Class[] { this.GSAdListenerClass }, new GreystripeProvider$GSAdListenerHandler(this, null));
                this.addListenerMethod.invoke(this.gsMobileBannerAdView, this.gsAdListenerProxy);
                final DisplayMetrics displayMetrics = this.context.getResources().getDisplayMetrics();
                this.gsMobileBannerAdView.setLayoutParams((ViewGroup$LayoutParams)new FrameLayout$LayoutParams((int)TypedValue.applyDimension(1, (float)n, displayMetrics), (int)TypedValue.applyDimension(1, (float)n2, displayMetrics)));
            }
            return this.gsMobileBannerAdView;
        }
        catch (Exception ex) {
            NexageLog.e("GreystripeProvider", "createAdView:", ex);
            this.gsMobileBannerAdView = null;
            return this.gsMobileBannerAdView;
        }
    }
    
    @Override
    protected final View getAdView() {
        return this.gsMobileBannerAdView;
    }
    
    @Override
    protected final void loadAdView() {
        NexageLog.d("GreystripeProvider", "loadAdView");
        try {
            this.refreshMethod.invoke(this.gsMobileBannerAdView, new Object[0]);
        }
        catch (Exception ex) {
            NexageLog.e("GreystripeProvider", "loadAdView:", ex);
        }
    }
}
