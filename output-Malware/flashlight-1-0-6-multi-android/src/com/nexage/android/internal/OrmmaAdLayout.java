// 
// Decompiled by Procyon v0.5.30
// 

package com.nexage.android.internal;

import android.view.ViewGroup$LayoutParams;
import android.widget.RelativeLayout$LayoutParams;
import android.os.Handler;
import com.nexage.android.NexageAdViewListener;
import com.nexage.ormma.view.OrmmaView$OrmmaViewListener;
import java.util.Iterator;
import android.view.View;
import android.content.Intent;
import com.nexage.android.NexageActivity;
import android.app.Activity;
import com.nexage.android.v2.Task;
import android.content.Context;
import com.nexage.ormma.view.OrmmaView;
import java.util.ArrayList;
import android.widget.RelativeLayout;

public class OrmmaAdLayout extends RelativeLayout
{
    private static final int FP = -1;
    private static boolean block;
    private static ArrayList s_List;
    private static volatile int s_Sequence;
    private OrmmaAd _ad;
    private OrmmaView _ormmaView;
    private OrmmaAdLayout$ADView _webView;
    private boolean m_Closing;
    private volatile RelativeLayout m_Expanded;
    private boolean m_Expanding;
    int m_ID;
    private final AdLayout m_Layout;
    boolean m_ormmaIsReady;
    private short originalBottom;
    private short originalLeft;
    private short originalRight;
    private short originalTop;
    
    static {
        OrmmaAdLayout.s_Sequence = 0;
        OrmmaAdLayout.s_List = new ArrayList();
    }
    
    public OrmmaAdLayout(final Context context, final Task task) {
        super(context);
        this.originalLeft = -1;
        this.originalTop = -1;
        this.originalRight = -1;
        this.originalBottom = -1;
        this.m_Expanded = null;
        this.m_ormmaIsReady = false;
        this.m_Layout = new OrmmaAdLayout$URLAdLayout(this, null);
    }
    
    public OrmmaAdLayout(final OrmmaAd ad, final Context context) {
        super(context);
        this.originalLeft = -1;
        this.originalTop = -1;
        this.originalRight = -1;
        this.originalBottom = -1;
        this.m_Expanded = null;
        this.m_ormmaIsReady = false;
        this.m_Layout = new OrmmaAdLayout$URLAdLayout(this, null);
        this._ad = ad;
        if (!ad.isInterstitial()) {
            this.init(ad, context);
        }
    }
    
    static boolean displayMM4RM(OrmmaAdLayout$ADView ormmaAdLayout$ADView) {
        if (ormmaAdLayout$ADView == null && !OrmmaAdLayout.s_List.isEmpty()) {
            final RelativeLayout relativeLayout = OrmmaAdLayout.s_List.get(0);
            if (relativeLayout != null && relativeLayout.getChildCount() > 0) {
                ormmaAdLayout$ADView = (OrmmaAdLayout$ADView)relativeLayout.getChildAt(0);
            }
        }
        if (ormmaAdLayout$ADView != null) {
            final Activity activity = (Activity)ormmaAdLayout$ADView.getContext();
            final Intent intent = new Intent((Context)activity, (Class)NexageActivity.class);
            intent.putExtra("com.nexage.MM4RM_AdID", ormmaAdLayout$ADView.m_ID);
            activity.startActivity(intent);
        }
        return ormmaAdLayout$ADView != null;
    }
    
    private void expandAd() {
        synchronized (this) {
            if (this.m_Expanded != null || !this.m_Expanding) {
                NexageLog.v(this._ad.getPosition(), "Expand: already expanded");
                this.m_Expanding = false;
            }
            else {
                this.removeView((View)this._webView);
                this.setLayoutParams((View)(this.m_Expanded = new RelativeLayout((Context)this.getContext())), -1, -1);
                this.m_Expanded.addView((View)this._webView);
                this.setLayoutParams((View)this._webView, -1, -1);
                OrmmaAdLayout.s_List.add(this.m_Expanded);
                displayMM4RM(this._webView);
                this.m_Expanding = false;
            }
        }
    }
    
    public static View getWebView(final int n, final NexageActivity nexageActivity) {
        while (true) {
            while (true) {
                Label_0082: {
                    synchronized (OrmmaAdLayout.class) {
                        OrmmaAdLayout$ADView ormmaAdLayout$ADView = null;
                        Block_4: {
                            for (final Object o : OrmmaAdLayout.s_List) {
                                ormmaAdLayout$ADView = (OrmmaAdLayout$ADView)((RelativeLayout)o).getChildAt(0);
                                if (n == ormmaAdLayout$ADView.m_ID) {
                                    break Block_4;
                                }
                            }
                            break Label_0082;
                        }
                        ormmaAdLayout$ADView.m_NexageActivity = nexageActivity;
                        final Object o;
                        if (o != null) {
                            OrmmaAdLayout.s_List.remove(o);
                        }
                        return (View)o;
                    }
                }
                Object o = null;
                continue;
            }
        }
    }
    
    private void init(final OrmmaAd ormmaAd, final Context context) {
        this._ormmaView = new OrmmaView(context);
        OrmmaAdLayout.block = false;
        this._ormmaView.loadDataFromString(this._ad.getHtml());
        this.setLayoutParams((View)this._ormmaView, ormmaAd.getWidth(), ormmaAd.getHeight());
        this._ormmaView.setListener(new OrmmaView$OrmmaViewListener() {
            @Override
            public void handleRequest(final String s) {
                NexageLog.v("Ormma calls url=" + s);
            }
            
            @Override
            public void onBillableEvent() {
                NexageLog.i(OrmmaAdLayout.this._ad.getPosition(), "OrmmaViewListener.onBillableEvent");
                OrmmaAdLayout.this._ad.addClickToReport();
            }
            
            @Override
            public void onClick() {
                NexageLog.i(OrmmaAdLayout.this._ad.getPosition(), "OrmmaViewListener.onClick");
                if (!OrmmaAdLayout.this.m_ormmaIsReady) {
                    NexageLog.i(OrmmaAdLayout.this._ad.getPosition(), "OrmmaViewListener.onClick adding click to report");
                    OrmmaAdLayout.this._ad.addClickToReport();
                }
            }
            
            @Override
            public boolean onEventFired() {
                NexageLog.v("Ormma is onEventFired");
                return false;
            }
            
            @Override
            public boolean onExpand() {
                NexageLog.v("Ormma is expanded");
                OrmmaAdLayout.block = true;
                final Handler handler = NexageGlobalHandler.getHandler();
                if (handler != null) {
                    handler.sendEmptyMessage(1);
                }
                if (OrmmaAdLayout.this._ad != null) {
                    final NexageAdViewListener nexageListener = OrmmaAdLayout.this._ad.getNexageListener();
                    if (nexageListener != null) {
                        OrmmaAdLayout.this.post((Runnable)new Runnable() {
                            @Override
                            public void run() {
                                nexageListener.onPresentScreen(OrmmaAdLayout.this._ad.getNexageAdView());
                            }
                        });
                    }
                }
                return false;
            }
            
            @Override
            public boolean onExpandClose() {
                NexageLog.v("Ormma is closed");
                OrmmaAdLayout.block = false;
                final Handler handler = NexageGlobalHandler.getHandler();
                if (handler != null) {
                    handler.sendEmptyMessage(2);
                }
                if (OrmmaAdLayout.this._ad != null) {
                    final NexageAdViewListener nexageListener = OrmmaAdLayout.this._ad.getNexageListener();
                    if (nexageListener != null) {
                        OrmmaAdLayout.this.post((Runnable)new Runnable() {
                            @Override
                            public void run() {
                                nexageListener.onDismissScreen(OrmmaAdLayout.this._ad.getNexageAdView());
                            }
                        });
                    }
                }
                return false;
            }
            
            @Override
            public void onFinishedLoading() {
                NexageLog.v("Ormma onFinishedLoading");
                final NexageAdSwitcher switcher = OrmmaAdLayout.this._ad.getSwitcher();
                if (switcher != null) {
                    switcher.addAdView((View)OrmmaAdLayout.this);
                }
            }
            
            @Override
            public void onHide() {
                if (OrmmaAdLayout.this._ad != null) {
                    final NexageAdViewListener nexageListener = OrmmaAdLayout.this._ad.getNexageListener();
                    if (nexageListener != null) {
                        OrmmaAdLayout.this.post((Runnable)new Runnable() {
                            @Override
                            public void run() {
                                nexageListener.onHide(OrmmaAdLayout.this._ad.getNexageAdView());
                            }
                        });
                    }
                }
            }
            
            @Override
            public boolean onReady() {
                NexageLog.v("Ormma is ready");
                OrmmaAdLayout.this.m_ormmaIsReady = true;
                return false;
            }
            
            @Override
            public boolean onResize() {
                NexageLog.v("Ormma onResize is called");
                return false;
            }
            
            @Override
            public boolean onResizeClose() {
                NexageLog.v("Ormma Resizedclose");
                return false;
            }
        });
        this.addView((View)this._ormmaView);
    }
    
    private void mm4rmCollapse() {
        synchronized (this) {
            if (this.m_Closing) {
                NexageLog.d(this._ad.getPosition(), "Collapse: already closing");
                return;
            }
            if (this.m_Expanded == null) {
                NexageLog.d(this._ad.getPosition(), "Collapse: already closed -- ignore");
                return;
            }
        }
        this.m_Closing = true;
        // monitorexit(this)
        NexageLog.v(this._ad.getPosition(), "Collapse");
        this._webView.m_NexageActivity.runOnUiThread((Runnable)new Runnable() {
            @Override
            public void run() {
                OrmmaAdLayout.this._webView.m_NexageActivity.dismiss();
            }
        });
    }
    
    private void restoreAdView() {
        if (this.m_Expanded == null) {
            return;
        }
        this.m_Expanded.removeView((View)this._webView);
        this.m_Expanded = null;
        this.restoreSize((View)this._webView);
        this.addView((View)this._webView);
        this.forceLayout();
        this._ad.mm4rmRestored();
        this.m_Closing = false;
    }
    
    private void restoreSize(final View view) {
        view.layout((int)this.originalLeft, (int)this.originalTop, (int)this.originalRight, (int)this.originalBottom);
        this.setLayoutParams(view, this.originalRight - this.originalLeft, this.originalBottom - this.originalTop);
    }
    
    private void setLayoutParams(final View view, final int n, final int n2) {
        final RelativeLayout$LayoutParams layoutParams = new RelativeLayout$LayoutParams(n, n2);
        layoutParams.setMargins(0, 0, 0, 0);
        view.setLayoutParams((ViewGroup$LayoutParams)layoutParams);
    }
    
    public void addDisplayToReport() {
        if (this._ad != null) {
            this._ad.addDisplayToReport();
        }
    }
    
    public void clearOrmmaView() {
        if (this._ormmaView != null) {
            this._ormmaView.clearView();
        }
    }
    
    AdLayout getLayout() {
        return this.m_Layout;
    }
    
    public OrmmaView getOrmmaView() {
        return this._ormmaView;
    }
    
    public void initForInterstitial(final Context context) {
        this.init(this._ad, context);
    }
    
    public boolean isBlock() {
        return OrmmaAdLayout.block;
    }
    
    public boolean isExpanded() {
        return this._ormmaView.isExpanded();
    }
    
    public void setBackgroundColor(final int n) {
        super.setBackgroundColor(n);
        this._ormmaView.setBackgroundColor(n);
    }
    
    public void setBackgroundResource(final int n) {
        super.setBackgroundResource(n);
        this._ormmaView.setBackgroundResource(n);
    }
    
    public void setVisibility(final int n) {
        super.setVisibility(n);
        this._ormmaView.setVisibility(n);
    }
}
