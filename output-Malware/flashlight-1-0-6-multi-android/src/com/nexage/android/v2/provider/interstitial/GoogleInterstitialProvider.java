// 
// Decompiled by Procyon v0.5.30
// 

package com.nexage.android.v2.provider.interstitial;

import com.nexage.android.internal.NexageGlobalHandler;
import android.util.Log;
import com.nexage.android.v2.TagInfo;
import com.nexage.android.reports2.ReportManager;
import com.nexage.android.v2.Task;
import com.google.android.gms.ads.AdListener;
import android.app.Activity;
import com.nexage.android.DeviceLocation;
import com.nexage.android.NexageAdManager$Gender;
import java.util.GregorianCalendar;
import android.text.TextUtils;
import com.nexage.android.NexageAdManager;
import com.google.android.gms.ads.AdRequest$Builder;
import com.google.android.gms.ads.AdRequest;
import com.nexage.android.internal.NexageLog;
import com.google.android.gms.ads.InterstitialAd;
import android.content.Context;
import com.nexage.android.v2.provider.BaseProvider;

public class GoogleInterstitialProvider extends BaseProvider implements InterstitialProvider
{
    private static final String TAG = "GoogleIntProvider";
    private Context context;
    private InterstitialAd interstitialAd;
    
    public GoogleInterstitialProvider() {
        NexageLog.d("GoogleIntProvider", "entering constructor");
        this.isSdkInitialized = true;
    }
    
    private AdRequest buildAdRequest() {
        int i = 0;
        final AdRequest$Builder adRequest$Builder = new AdRequest$Builder();
        if (NexageAdManager.isTestMode()) {
            NexageLog.d("GoogleIntProvider", "setting test mode");
            adRequest$Builder.addTestDevice(AdRequest.DEVICE_ID_EMULATOR);
        }
        final GregorianCalendar birthday = NexageAdManager.getBirthday();
        if (birthday != null) {
            adRequest$Builder.setBirthday(birthday.getTime());
        }
        final NexageAdManager$Gender gender = NexageAdManager.getGender();
        if (gender != null) {
            switch (gender) {
                case Male: {
                    adRequest$Builder.setGender(1);
                    break;
                }
                case Female: {
                    adRequest$Builder.setGender(2);
                    break;
                }
                case Other: {
                    adRequest$Builder.setGender(0);
                    break;
                }
            }
        }
        final DeviceLocation locationAwareness = NexageAdManager.getLocationAwareness();
        if (locationAwareness != null) {
            adRequest$Builder.setLocation(locationAwareness.getLocation());
        }
        final String keywords = NexageAdManager.getKeywords();
        if (!TextUtils.isEmpty((CharSequence)keywords)) {
            for (String[] split = keywords.split(","); i < split.length; ++i) {
                adRequest$Builder.addKeyword(split[i]);
            }
        }
        return adRequest$Builder.build();
    }
    
    @Override
    public void cancel() {
        NexageLog.d("GoogleIntProvider", "entering cancel");
        if (!this.isSdkInitialized || this.context == null) {
            NexageLog.w("GoogleIntProvider", "cancel failed");
            return;
        }
        ((Activity)this.context).runOnUiThread((Runnable)new Runnable() {
            @Override
            public void run() {
                GoogleInterstitialProvider.this.interstitialAd.setAdListener(null);
            }
        });
    }
    
    @Override
    public void display(final Task task) {
        NexageLog.d("GoogleIntProvider", "entering display");
        if (!this.isSdkInitialized || this.context == null) {
            NexageLog.w("GoogleIntProvider", "display failed");
            return;
        }
        ((Activity)this.context).runOnUiThread((Runnable)new Runnable() {
            @Override
            public void run() {
                if (GoogleInterstitialProvider.this.interstitialAd.isLoaded()) {
                    GoogleInterstitialProvider.this.interstitialAd.show();
                    ReportManager.addDisplayEvent(task.adService, task);
                    task.displayed = true;
                    NexageLog.d("GoogleIntProvider", "displaying...");
                    return;
                }
                Log.w("GoogleIntProvider", "interstitial is not ready");
            }
        });
    }
    
    @Override
    public void getAd(final Context context, final Task task) {
        synchronized (this) {
            NexageLog.d("GoogleIntProvider", "entering getAd");
            if (!this.isSdkInitialized || context == null || task == null) {
                this.fireAdFailed(task);
            }
            else {
                this.context = context;
                ((Activity)context).runOnUiThread((Runnable)new Runnable() {
                    @Override
                    public void run() {
                        final String siteId = task.adTag.siteId;
                        GoogleInterstitialProvider.this.interstitialAd = new InterstitialAd(context);
                        GoogleInterstitialProvider.this.interstitialAd.setAdUnitId(siteId);
                        GoogleInterstitialProvider.this.interstitialAd.setAdListener(new AdListener() {
                            @Override
                            public void onAdClosed() {
                                NexageLog.d("GoogleIntProvider", "onAdClosed");
                                NexageGlobalHandler.setGlobalAdServingEnabled(true);
                            }
                            
                            @Override
                            public void onAdFailedToLoad(final int n) {
                                NexageLog.d("GoogleIntProvider", "onAdFailedToLoad " + n);
                                GoogleInterstitialProvider.this.fireAdFailed(task);
                            }
                            
                            @Override
                            public void onAdLeftApplication() {
                                NexageLog.d("GoogleIntProvider", "onAdLeftApplication");
                            }
                            
                            @Override
                            public void onAdLoaded() {
                                NexageLog.d("GoogleIntProvider", "onAdLoaded");
                                GoogleInterstitialProvider.this.fireAdReceived(task);
                            }
                            
                            @Override
                            public void onAdOpened() {
                                NexageLog.d("GoogleIntProvider", "onAdOpened");
                                NexageGlobalHandler.setGlobalAdServingEnabled(false);
                            }
                        });
                        GoogleInterstitialProvider.this.interstitialAd.loadAd(GoogleInterstitialProvider.this.buildAdRequest());
                    }
                });
            }
        }
    }
    
    @Override
    public String getProviderId() {
        return "ADMOB";
    }
}
