// 
// Decompiled by Procyon v0.5.30
// 

package com.nexage.ormma.controller;

import java.io.InputStream;
import android.content.Intent;
import com.nexage.android.internal.NexageLog;
import android.database.Cursor;
import android.widget.ListAdapter;
import java.util.Map;
import android.content.DialogInterface;
import android.content.DialogInterface$OnClickListener;
import java.util.List;
import android.widget.SimpleAdapter;
import android.app.AlertDialog$Builder;
import java.util.HashMap;
import java.util.ArrayList;
import android.util.Log;
import android.text.TextUtils;
import android.content.ContentResolver;
import android.widget.Toast;
import android.net.Uri;
import android.os.Build$VERSION;
import android.content.ContentValues;
import android.content.Context;
import com.nexage.ormma.view.OrmmaView;

public class OrmmaUtilityController extends OrmmaController
{
    private static final String LOG_TAG = "OrmmaUtilityController";
    private OrmmaAssetController mAssetController;
    private OrmmaDisplayController mDisplayController;
    private OrmmaLocationController mLocationController;
    private OrmmaNetworkController mNetworkController;
    private OrmmaSensorController mSensorController;
    
    public OrmmaUtilityController(final OrmmaView ormmaView, final Context context) {
        super(ormmaView, context);
        this.mAssetController = new OrmmaAssetController(ormmaView, context);
        this.mDisplayController = new OrmmaDisplayController(ormmaView, context);
        this.mLocationController = new OrmmaLocationController(ormmaView, context);
        this.mNetworkController = new OrmmaNetworkController(ormmaView, context);
        this.mSensorController = new OrmmaSensorController(ormmaView, context);
        ormmaView.addJavascriptInterface((Object)this.mAssetController, "ORMMAAssetsControllerBridge");
        ormmaView.addJavascriptInterface((Object)this.mDisplayController, "ORMMADisplayControllerBridge");
        ormmaView.addJavascriptInterface((Object)this.mLocationController, "ORMMALocationControllerBridge");
        ormmaView.addJavascriptInterface((Object)this.mNetworkController, "ORMMANetworkControllerBridge");
        ormmaView.addJavascriptInterface((Object)this.mSensorController, "ORMMASensorControllerBridge");
    }
    
    private void addCalendarEvent(final int n, final String s, final String s2, final String s3) {
        final ContentResolver contentResolver = this.mContext.getContentResolver();
        final long long1 = Long.parseLong(s);
        final long n2 = 3600000L + long1;
        final ContentValues contentValues = new ContentValues();
        contentValues.put("calendar_id", n);
        contentValues.put("title", s2);
        contentValues.put("description", s3);
        contentValues.put("dtstart", long1);
        contentValues.put("hasAlarm", 1);
        contentValues.put("dtend", n2);
        Uri uri;
        if (Build$VERSION.SDK_INT == 8) {
            uri = contentResolver.insert(Uri.parse("content://com.android.calendar/events"), contentValues);
        }
        else {
            uri = contentResolver.insert(Uri.parse("content://calendar/events"), contentValues);
        }
        if (uri != null) {
            final long long2 = Long.parseLong(uri.getLastPathSegment());
            final ContentValues contentValues2 = new ContentValues();
            contentValues2.put("event_id", long2);
            contentValues2.put("method", 1);
            contentValues2.put("minutes", 15);
            if (Build$VERSION.SDK_INT == 8) {
                contentResolver.insert(Uri.parse("content://com.android.calendar/reminders"), contentValues2);
            }
            else {
                contentResolver.insert(Uri.parse("content://calendar/reminders"), contentValues2);
            }
        }
        Toast.makeText(this.mContext, (CharSequence)"Event added to calendar", 0).show();
    }
    
    private String createTelUrl(final String s) {
        if (TextUtils.isEmpty((CharSequence)s)) {
            return null;
        }
        final StringBuilder sb = new StringBuilder("tel:");
        sb.append(s);
        return sb.toString();
    }
    
    private String getSupports() {
        int n = 1;
        String s = "supports: [ 'level-1', 'level-2', 'screen', 'orientation', 'network'";
        int n2;
        if (this.mLocationController.allowLocationServices() && (this.mContext.checkCallingOrSelfPermission("android.permission.ACCESS_COARSE_LOCATION") == 0 || this.mContext.checkCallingOrSelfPermission("android.permission.ACCESS_FINE_LOCATION") == 0)) {
            n2 = n;
        }
        else {
            n2 = 0;
        }
        if (n2 != 0) {
            s += ", 'location'";
        }
        int n3;
        if (this.mContext.checkCallingOrSelfPermission("android.permission.SEND_SMS") == 0) {
            n3 = n;
        }
        else {
            n3 = 0;
        }
        if (n3 != 0) {
            s += ", 'sms'";
        }
        int n4;
        if (this.mContext.checkCallingOrSelfPermission("android.permission.CALL_PHONE") == 0) {
            n4 = n;
        }
        else {
            n4 = 0;
        }
        if (n4 != 0) {
            s += ", 'phone'";
        }
        if (this.mContext.checkCallingOrSelfPermission("android.permission.WRITE_CALENDAR") != 0 || this.mContext.checkCallingOrSelfPermission("android.permission.READ_CALENDAR") != 0) {
            n = 0;
        }
        if (n != 0) {
            s += ", 'calendar'";
        }
        final String string = s + ", 'video'" + ", 'audio'" + ", 'map'" + ", 'email' ]";
        Log.d("OrmmaUtilityController", "getSupports: " + string);
        return string;
    }
    
    public void activate(final String s) {
        Log.d("OrmmaUtilityController", "activate: " + s);
        if (s.equalsIgnoreCase("networkChange")) {
            this.mNetworkController.startNetworkListener();
        }
        else {
            if (this.mLocationController.allowLocationServices() && s.equalsIgnoreCase("locationChange")) {
                this.mLocationController.startLocationListener();
                return;
            }
            if (s.equalsIgnoreCase("shake")) {
                this.mSensorController.startShakeListener();
                return;
            }
            if (s.equalsIgnoreCase("tiltChange")) {
                this.mSensorController.startTiltListener();
                return;
            }
            if (s.equalsIgnoreCase("headingChange")) {
                this.mSensorController.startHeadingListener();
                return;
            }
            if (s.equalsIgnoreCase("orientationChange")) {
                this.mDisplayController.startConfigurationListener();
            }
        }
    }
    
    public String copyTextFromJarIntoAssetDir(final String s, final String s2) {
        return this.mAssetController.copyTextFromJarIntoAssetDir(s, s2);
    }
    
    public void createEvent(final String s, final String s2, final String s3) {
        Log.d("OrmmaUtilityController", "createEvent: date: " + s + " title: " + s2 + " body: " + s3);
        final ContentResolver contentResolver = this.mContext.getContentResolver();
        final String[] array = { "_id", "displayName", "_sync_account" };
        Cursor cursor;
        if (Build$VERSION.SDK_INT == 8) {
            cursor = contentResolver.query(Uri.parse("content://com.android.calendar/calendars"), array, (String)null, (String[])null, (String)null);
        }
        else {
            cursor = contentResolver.query(Uri.parse("content://calendar/calendars"), array, (String)null, (String[])null, (String)null);
        }
        if (cursor == null || (cursor != null && !cursor.moveToFirst())) {
            Toast.makeText(this.mContext, (CharSequence)"No calendar account found", 1).show();
            if (cursor != null) {
                cursor.close();
            }
            return;
        }
        if (cursor.getCount() == 1) {
            this.addCalendarEvent(cursor.getInt(0), s, s2, s3);
        }
        else {
            final ArrayList<HashMap<String, String>> list = new ArrayList<HashMap<String, String>>();
            for (int i = 0; i < cursor.getCount(); ++i) {
                final HashMap<String, String> hashMap = new HashMap<String, String>();
                hashMap.put("ID", cursor.getString(0));
                hashMap.put("NAME", cursor.getString(1));
                hashMap.put("EMAILID", cursor.getString(2));
                list.add(hashMap);
                cursor.moveToNext();
            }
            final AlertDialog$Builder alertDialog$Builder = new AlertDialog$Builder(this.mContext);
            alertDialog$Builder.setTitle((CharSequence)"Choose Calendar to save event to");
            alertDialog$Builder.setSingleChoiceItems((ListAdapter)new SimpleAdapter(this.mContext, (List)list, 17367053, new String[] { "NAME", "EMAILID" }, new int[] { 16908308, 16908309 }), -1, (DialogInterface$OnClickListener)new DialogInterface$OnClickListener() {
                public void onClick(final DialogInterface dialogInterface, final int n) {
                    OrmmaUtilityController.this.addCalendarEvent(Integer.parseInt(list.get(n).get("ID")), s, s2, s3);
                    dialogInterface.cancel();
                }
            });
            alertDialog$Builder.create().show();
        }
        cursor.close();
    }
    
    public void deactivate(final String s) {
        Log.d("OrmmaUtilityController", "deactivate: " + s);
        if (s.equalsIgnoreCase("networkChange")) {
            this.mNetworkController.stopNetworkListener();
        }
        else {
            if (s.equalsIgnoreCase("locationChange")) {
                this.mLocationController.stopAllListeners();
                return;
            }
            if (s.equalsIgnoreCase("shake")) {
                this.mSensorController.stopShakeListener();
                return;
            }
            if (s.equalsIgnoreCase("tiltChange")) {
                this.mSensorController.stopTiltListener();
                return;
            }
            if (s.equalsIgnoreCase("headingChange")) {
                this.mSensorController.stopHeadingListener();
                return;
            }
            if (s.equalsIgnoreCase("orientationChange")) {
                this.mDisplayController.stopConfigurationListener();
            }
        }
    }
    
    public void deleteOldAds() {
        this.mAssetController.deleteOldAds();
    }
    
    public void init(final float n) {
        final String string = "window.ormmaview.fireChangeEvent({ state: 'default', network: '" + this.mNetworkController.getNetwork() + "', size: " + this.mDisplayController.getSize() + ", maxSize: " + this.mDisplayController.getMaxSize() + ", screenSize: " + this.mDisplayController.getScreenSize() + ", defaultPosition: { x:" + (int)(this.mOrmmaView.getLeft() / n) + ", y: " + (int)(this.mOrmmaView.getTop() / n) + ", width: " + (int)(this.mOrmmaView.getWidth() / n) + ", height: " + (int)(this.mOrmmaView.getHeight() / n) + " }, orientation:" + this.mDisplayController.getOrientation() + "," + this.getSupports() + " });";
        NexageLog.d("OrmmaUtilityController", "init: injection: " + string);
        this.mOrmmaView.injectJavaScript(string);
    }
    
    public void makeCall(final String s) {
        Log.d("OrmmaUtilityController", "makeCall: number: " + s);
        final String telUrl = this.createTelUrl(s);
        if (telUrl == null) {
            this.mOrmmaView.raiseError("Bad Phone Number", "makeCall");
            return;
        }
        final Intent intent = new Intent("android.intent.action.CALL", Uri.parse(telUrl.toString()));
        intent.addFlags(268435456);
        this.mContext.startActivity(intent);
    }
    
    public void ready() {
        this.mOrmmaView.injectJavaScript("Ormma.setState(\"" + this.mOrmmaView.getState() + "\");");
        this.mOrmmaView.injectJavaScript("ORMMAReady();");
    }
    
    public void sendMail(final String s, final String s2, final String s3) {
        Log.d("OrmmaUtilityController", "sendMail: recipient: " + s + " subject: " + s2 + " body: " + s3);
        final Intent intent = new Intent("android.intent.action.SEND");
        intent.setType("plain/text");
        intent.putExtra("android.intent.extra.EMAIL", new String[] { s });
        intent.putExtra("android.intent.extra.SUBJECT", s2);
        intent.putExtra("android.intent.extra.TEXT", s3);
        intent.addFlags(268435456);
        this.mContext.startActivity(intent);
    }
    
    public void sendSMS(final String s, final String s2) {
        Log.d("OrmmaUtilityController", "sendSMS: recipient: " + s + " body: " + s2);
        final Intent intent = new Intent("android.intent.action.VIEW");
        intent.putExtra("address", s);
        intent.putExtra("sms_body", s2);
        intent.setType("vnd.android-dir/mms-sms");
        intent.addFlags(268435456);
        this.mContext.startActivity(intent);
    }
    
    public void setMaxSize(final int n, final int n2) {
        this.mDisplayController.setMaxSize(n, n2);
    }
    
    public void showAlert(final String s) {
        Log.e("OrmmaUtilityController", s);
    }
    
    @Override
    public void stopAllListeners() {
        try {
            this.mAssetController.stopAllListeners();
            this.mDisplayController.stopAllListeners();
            this.mLocationController.stopAllListeners();
            this.mNetworkController.stopAllListeners();
            this.mSensorController.stopAllListeners();
        }
        catch (Exception ex) {}
    }
    
    public String writeToDiskWrap(final InputStream inputStream, final String s, final boolean b, final String s2, final String s3, final String s4) {
        return this.mAssetController.writeToDiskWrap(inputStream, s, b, s2, s3, s4);
    }
}
