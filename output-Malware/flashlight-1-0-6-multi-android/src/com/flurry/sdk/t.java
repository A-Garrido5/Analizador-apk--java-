// 
// Decompiled by Procyon v0.5.30
// 

package com.flurry.sdk;

import com.flurry.android.impl.ads.avro.protocol.v10.AdFrame;
import java.util.Iterator;
import android.text.TextUtils;
import java.util.List;
import com.flurry.android.impl.ads.avro.protocol.v10.AdUnit;
import android.view.ViewGroup;
import com.flurry.android.FlurryAdSize;
import android.content.SharedPreferences$Editor;
import android.content.SharedPreferences;
import java.io.File;
import java.util.HashMap;
import com.flurry.android.impl.ads.avro.protocol.v10.Configuration;
import java.util.Map;
import com.flurry.android.impl.ads.FlurryAdModule;

public class t
{
    private static final String a;
    private final FlurryAdModule b;
    private final w c;
    private final Map d;
    private final Map e;
    private Configuration f;
    private int g;
    private boolean h;
    
    static {
        a = t.class.getSimpleName();
    }
    
    public t(final FlurryAdModule b) {
        this.b = b;
        this.c = new w();
        this.d = new HashMap();
        this.e = new HashMap();
    }
    
    private t$a a(final String s) {
        synchronized (this) {
            t$a t$a = this.e.get(s);
            if (t$a == null) {
                t$a = new t$a(this, s);
                this.e.put(s, t$a);
            }
            return t$a;
        }
    }
    
    private void e() {
        while (true) {
            Label_0038: {
                synchronized (this) {
                    if (this.f != null) {
                        if (!this.h) {
                            break Label_0038;
                        }
                        eo.a(3, t.a, "Media player assets: download not necessary");
                    }
                    return;
                }
            }
            String string;
            if (this.g < 3) {
                string = this.f.b().toString() + "android.zip";
            }
            else {
                string = "http://flurry.cachefly.net/vast/videocontrols/v1/android.zip";
            }
            final File fileStreamPath = do.a().b().getFileStreamPath(".flurryads.mediaassets");
            final SharedPreferences sharedPreferences = do.a().b().getSharedPreferences("FLURRY_SHARED_PREFERENCES", 0);
            final String string2 = sharedPreferences.getString("flurry_last_media_asset_url", (String)null);
            if (string2 != null && string2.equals(string) && fileStreamPath.exists()) {
                eo.a(3, t.a, "Media player assets: unchanged, download not necessary");
                this.h = true;
                return;
            }
            final File fileStreamPath2 = do.a().b().getFileStreamPath(".flurryads.mediaassets.tmp");
            fileStreamPath2.delete();
            eo.a(3, t.a, "Media player assets: attempting download from url: " + string);
            final at at = new at(fileStreamPath2);
            at.a(string);
            at.a(new as$a() {
                @Override
                public void a(final as as) {
                    if (!as.a() || !fileStreamPath2.exists()) {
                        eo.a(3, t.a, "Media player assets: download failed");
                        if (ev.a().c()) {
                            t.this.g++;
                        }
                        do.a().a(new ff() {
                            @Override
                            public void a() {
                                t.this.e();
                            }
                        }, 10000L);
                        return;
                    }
                    fileStreamPath.delete();
                    if (fileStreamPath2.renameTo(fileStreamPath)) {
                        eo.a(3, t.a, "Media player assets: download successful");
                        final SharedPreferences$Editor edit = sharedPreferences.edit();
                        edit.putString("flurry_last_media_asset_url", string);
                        edit.commit();
                        t.this.h = true;
                        return;
                    }
                    eo.a(3, t.a, "Media player assets: couldn't rename tmp file (giving up)");
                }
            });
            at.d();
        }
    }
    
    public void a() {
        if (this.f == null) {
            this.a("", null, FlurryAdSize.BANNER_BOTTOM, true, null);
            return;
        }
        this.e();
    }
    
    public void a(final String s, final ViewGroup viewGroup, final FlurryAdSize flurryAdSize, final boolean b, final AdUnit adUnit) {
        eo.a(3, t.a, "requestAd: adSpaceName = " + s + ", viewGroup = " + viewGroup + ", size = " + flurryAdSize + ", refresh = " + b);
        this.a(s).a(viewGroup, flurryAdSize, b, adUnit);
    }
    
    public void a(final String s, final List list, final int n) {
        synchronized (this) {
            if (!TextUtils.isEmpty((CharSequence)s) && list != null && list.size() > 0) {
                this.a(s).a(list, n);
            }
        }
    }
    
    public void b() {
        final Iterator<t$a> iterator = this.e.values().iterator();
        while (iterator.hasNext()) {
            iterator.next().a();
        }
        this.e.clear();
    }
    
    public File c() {
        if (this.h) {
            return do.a().b().getFileStreamPath(".flurryads.mediaassets");
        }
        return null;
    }
}
