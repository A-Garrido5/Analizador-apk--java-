// 
// Decompiled by Procyon v0.5.30
// 

package com.millennialmedia.android;

import android.webkit.WebView;
import android.view.MotionEvent;
import android.os.Bundle;
import android.os.Parcelable;
import android.app.Activity;
import android.view.GestureDetector$OnGestureListener;
import android.view.View$OnClickListener;
import android.view.ViewParent;
import android.view.ViewGroup$LayoutParams;
import android.widget.RelativeLayout$LayoutParams;
import android.view.ViewGroup;
import android.util.AttributeSet;
import android.content.Context;
import android.view.GestureDetector;
import android.view.View;
import android.widget.RelativeLayout;

abstract class MMLayout extends RelativeLayout implements InlineVideoView$TransparentFix, MMAd
{
    static final String BOTTOM_CENTER = "bottom-center";
    static final String BOTTOM_LEFT = "bottom-left";
    static final String BOTTOM_RIGHT = "bottom-right";
    static final String CENTER = "center";
    private static final int CLOSE_AREA_SIZE = 50;
    public static final String KEY_HEIGHT = "height";
    public static final String KEY_WIDTH = "width";
    private static final String TAG = "MMLayout";
    static final String TOP_CENTER = "top-center";
    static final String TOP_LEFT = "top-left";
    static final String TOP_RIGHT = "top-right";
    private static boolean appInit;
    MMAdImpl adImpl;
    View blackView;
    View closeAreaView;
    private GestureDetector diagnosticDetector;
    String goalId;
    RelativeLayout inlineVideoLayout;
    InlineVideoView inlineVideoView;
    boolean isResizing;
    
    protected MMLayout(final Context context) {
        super(context);
        this.initLayout(context);
    }
    
    protected MMLayout(final Context context, final AttributeSet set, final int n) {
        super(context, set, n);
        this.initLayout(context);
    }
    
    private void initInlineVideoTransparentFix() {
        if (this.blackView != null) {
            final ViewParent parent = this.blackView.getParent();
            if (parent != null && parent instanceof ViewGroup) {
                ((ViewGroup)parent).removeView(this.blackView);
                this.blackView = null;
            }
        }
        (this.blackView = new View(this.getContext())).setBackgroundColor(-16777216);
        this.blackView.setLayoutParams((ViewGroup$LayoutParams)new RelativeLayout$LayoutParams(-1, -1));
        if (this.inlineVideoLayout != null && this.blackView.getParent() == null) {
            this.inlineVideoLayout.addView(this.blackView);
        }
    }
    
    private void internalSetCloseArea(final String s) {
        if (this.closeAreaView == null) {
            this.closeAreaView = new View(this.getContext());
            final float density = this.getContext().getResources().getDisplayMetrics().density;
            final RelativeLayout$LayoutParams relativeLayout$LayoutParams = new RelativeLayout$LayoutParams((int)(50.0f * density), (int)(density * 50.0f));
            if ("top-right".equals(s)) {
                relativeLayout$LayoutParams.addRule(11);
            }
            else if ("top-center".equals(s)) {
                relativeLayout$LayoutParams.addRule(14);
            }
            else if ("bottom-left".equals(s)) {
                relativeLayout$LayoutParams.addRule(12);
            }
            else if ("bottom-center".equals(s)) {
                relativeLayout$LayoutParams.addRule(12);
                relativeLayout$LayoutParams.addRule(14);
            }
            else if ("bottom-right".equals(s)) {
                relativeLayout$LayoutParams.addRule(12);
                relativeLayout$LayoutParams.addRule(11);
            }
            else if ("center".equals(s)) {
                relativeLayout$LayoutParams.addRule(13);
            }
            this.closeAreaView.setOnClickListener((View$OnClickListener)new View$OnClickListener() {
                public void onClick(final View view) {
                    MMLayout.this.closeAreaTouched();
                }
            });
            this.addView(this.closeAreaView, (ViewGroup$LayoutParams)relativeLayout$LayoutParams);
        }
    }
    
    public void addBlackView() {
        this.initInlineVideoTransparentFix();
        if (this.blackView != null) {
            this.blackView.setVisibility(0);
        }
    }
    
    void addInlineVideo() {
        if (this.inlineVideoLayout != null && this.inlineVideoLayout.getParent() != null) {
            ((ViewGroup)this.inlineVideoLayout.getParent()).removeView((View)this.inlineVideoLayout);
        }
        (this.inlineVideoLayout = new RelativeLayout(this.getContext())).setId(892934232);
        if (this.inlineVideoView.getParent() != null) {
            ((ViewGroup)this.inlineVideoView.getParent()).removeView((View)this.inlineVideoView);
        }
        this.inlineVideoLayout.addView((View)this.inlineVideoView);
        if (this.blackView != null) {
            if (this.blackView.getParent() == null) {
                this.inlineVideoLayout.addView(this.blackView);
            }
            this.blackView.bringToFront();
        }
        this.addView((View)this.inlineVideoLayout, (ViewGroup$LayoutParams)this.inlineVideoView.getCustomLayoutParams());
    }
    
    boolean adjustVideo(final InlineVideoView$InlineParams inlineVideoView$InlineParams) {
        MMSDK.runOnUiThread(new Runnable() {
            @Override
            public void run() {
                if (MMLayout.this.inlineVideoView != null) {
                    MMLayout.this.inlineVideoView.adjustVideo(inlineVideoView$InlineParams);
                }
            }
        });
        return false;
    }
    
    void closeAreaTouched() {
    }
    
    protected void finalize() {
        if (this.getId() == -1) {
            this.adImpl.isFinishing = true;
            MMLog.d("MMLayout", "finalize() for " + this.adImpl);
            MMAdImplController.removeAdViewController(this.adImpl);
        }
    }
    
    void fullScreenVideoLayout() {
    }
    
    public String getApid() {
        return this.adImpl.getApid();
    }
    
    public boolean getIgnoresDensityScaling() {
        return this.adImpl.getIgnoresDensityScaling();
    }
    
    public RequestListener getListener() {
        return this.adImpl.getListener();
    }
    
    public MMRequest getMMRequest() {
        return this.adImpl.getMMRequest();
    }
    
    void initInlineVideo(final InlineVideoView$InlineParams inlineVideoView$InlineParams) {
        if (this.inlineVideoView != null) {
            final ViewGroup viewGroup = (ViewGroup)this.inlineVideoView.getParent();
            if (viewGroup != null) {
                viewGroup.removeView((View)this.inlineVideoView);
            }
            if (this.inlineVideoView.isPlaying()) {
                this.inlineVideoView.stopPlayback();
            }
            this.inlineVideoView = null;
        }
        (this.inlineVideoView = new InlineVideoView(this)).initInlineVideo(inlineVideoView$InlineParams);
        final RelativeLayout$LayoutParams layoutParams = new RelativeLayout$LayoutParams(-1, -1);
        layoutParams.addRule(13, -1);
        this.inlineVideoView.setLayoutParams((ViewGroup$LayoutParams)layoutParams);
        this.addInlineVideo();
    }
    
    protected final void initLayout(final Context context) {
        while (true) {
            try {
                MMLog.i("MMLayout", "Initializing MMLayout.");
                MMSDK.checkPermissions(context);
                MMSDK.checkActivity(context);
                this.diagnosticDetector = new GestureDetector(context.getApplicationContext(), (GestureDetector$OnGestureListener)new MMLayout$LayoutGestureListener(this));
                if (!MMLayout.appInit) {
                    MMLog.d("MMLayout", "********** Millennial Device Id *****************");
                    MMLog.d("MMLayout", MMSDK.getMMdid(context));
                    MMLog.d("MMLayout", "Use the above identifier to register this device and receive test ads. Test devices can be registered and administered through your account at http://mmedia.com.");
                    MMLog.d("MMLayout", "*************************************************");
                    AdCache.cleanCache(context);
                    MMLayout.appInit = true;
                }
            }
            catch (Exception ex) {
                MMLog.e("MMLayout", "There was an exception initializing the MMAdView. ", ex);
                ex.printStackTrace();
                continue;
            }
            break;
        }
    }
    
    boolean isVideoPlayingStreaming() {
        return this.inlineVideoView != null && this.inlineVideoView.isPlayingStreaming();
    }
    
    void loadUrl(final String s) {
        if (MMSDK.isConnected(this.getContext())) {
            if (this.adImpl.controller != null) {
                this.adImpl.controller.loadUrl(s);
            }
            return;
        }
        MMLog.e("MMLayout", "No network available, can't load overlay.");
    }
    
    void loadWebContent(final String s, final String s2) {
        if (MMSDK.isConnected(this.getContext())) {
            if (this.adImpl.controller != null) {
                this.adImpl.controller.loadWebContent(s, s2);
            }
            return;
        }
        MMLog.e("MMLayout", "No network available, can't load overlay.");
    }
    
    protected void onAttachedToWindow() {
        super.onAttachedToWindow();
        if (!this.isInEditMode()) {
            MMLog.d("MMLayout", "onAttachedToWindow for " + this.adImpl);
            if (this.getId() == -1) {
                MMLog.w("MMLayout", "MMAd missing id from getId(). Performance will be affected for configuration changes.");
            }
            if (!this.isResizing) {
                MMAdImplController.assignAdViewController(this.adImpl);
            }
            if (this.inlineVideoLayout != null) {
                this.inlineVideoLayout.bringToFront();
            }
            if (this.adImpl != null && this.adImpl.controller != null && this.adImpl.controller.webView != null) {
                this.adImpl.controller.webView.enableSendingSize();
            }
        }
    }
    
    protected void onDetachedFromWindow() {
        super.onDetachedFromWindow();
        MMLog.d("MMLayout", "onDetachedFromWindow for" + this.adImpl);
        final Context context = this.getContext();
        if (this.adImpl.adType == "i" && context != null && context instanceof Activity && ((Activity)context).isFinishing()) {
            this.adImpl.isFinishing = true;
        }
        if (!this.isResizing) {
            MMAdImplController.removeAdViewController(this.adImpl);
        }
    }
    
    protected void onRestoreInstanceState(final Parcelable parcelable) {
        final Bundle bundle = (Bundle)parcelable;
        final long internalId = this.adImpl.internalId;
        this.adImpl.internalId = bundle.getLong("MMAdImplId");
        this.adImpl.linkForExpansionId = bundle.getLong("MMAdImplLinkedId");
        MMLog.d("MMLayout", "onRestoreInstanceState replacing adImpl-" + internalId + " with " + this.adImpl + " id=" + this.getId());
        final String string = bundle.getString("inlineVideoViewGson");
        if (string != null) {
            this.initInlineVideo(InlineVideoView$InlineParams.getInlineParams(string));
        }
        super.onRestoreInstanceState(bundle.getParcelable("super"));
    }
    
    protected Parcelable onSaveInstanceState() {
        super.onSaveInstanceState();
        MMLog.d("MMLayout", "onSaveInstanceState saving - " + this.adImpl + " id=" + this.getId());
        final Bundle bundle = new Bundle();
        bundle.putParcelable("super", super.onSaveInstanceState());
        bundle.putLong("MMAdImplId", this.adImpl.internalId);
        bundle.putLong("MMAdImplLinkedId", this.adImpl.linkForExpansionId);
        if (this.inlineVideoView != null) {
            if (this.inlineVideoView.isPlaying()) {
                this.inlineVideoView.inlineParams.currentPosition = this.inlineVideoView.getCurrentPosition();
            }
            bundle.putString("inlineVideoViewGson", this.inlineVideoView.getGsonState());
        }
        return (Parcelable)bundle;
    }
    
    public boolean onTouchEvent(final MotionEvent motionEvent) {
        return this.diagnosticDetector.onTouchEvent(motionEvent) || !this.isClickable() || super.onTouchEvent(motionEvent);
    }
    
    @Deprecated
    public void onWindowFocusChanged(final boolean b) {
        super.onWindowFocusChanged(b);
        Label_0236: {
            if (!b) {
                break Label_0236;
            }
            if (this.inlineVideoView != null) {
                this.inlineVideoView.resumeVideo();
            }
        Label_0120_Outer:
            while (true) {
                MMLog.d("MMLayout", String.format("Window Focus Changed. For %s, Window in focus?: %b Controllers: %s", this.adImpl, b, MMAdImplController.controllersToString()));
                Label_0253: {
                    if (this.adImpl != null && this.adImpl.controller != null && this.adImpl.controller.webView != null) {
                        if (!b) {
                            break Label_0253;
                        }
                        this.adImpl.controller.webView.onResumeWebView();
                        this.adImpl.controller.webView.setMraidViewableVisible();
                    }
                    while (true) {
                        if (!b && this.getContext() instanceof Activity) {
                            final Activity activity = (Activity)this.getContext();
                            if (activity == null || (activity.isFinishing() && this.adImpl != null)) {
                                this.adImpl.isFinishing = true;
                                if (this.adImpl.controller != null && this.adImpl.controller.webView != null) {
                                    this.adImpl.controller.webView.setMraidHidden();
                                    MMAdImplController.removeAdViewController(this.adImpl);
                                }
                            }
                        }
                        final BridgeMMMedia$Audio sharedAudio = BridgeMMMedia$Audio.sharedAudio(this.getContext());
                        if (sharedAudio == null) {
                            return;
                        }
                        synchronized (this) {
                            sharedAudio.stop();
                            return;
                            // iftrue(Label_0023:, this.inlineVideoView == null)
                            this.inlineVideoView.pauseVideo();
                            continue Label_0120_Outer;
                            BridgeMMSpeechkit.releaseSpeechKit();
                            this.adImpl.controller.webView.setMraidViewableHidden();
                            this.adImpl.controller.webView.onPauseWebView();
                            continue;
                        }
                        break;
                    }
                }
                break;
            }
        }
    }
    
    void pauseVideo() {
        if (this.inlineVideoView != null) {
            this.inlineVideoView.pauseVideo();
        }
    }
    
    void playVideo() {
        if (this.inlineVideoView != null) {
            this.inlineVideoView.playVideo();
        }
    }
    
    public void removeBlackView() {
        if (this.blackView != null) {
            this.blackView.setVisibility(4);
        }
    }
    
    void removeCloseTouchDelegate() {
        if (this.closeAreaView != null && this.closeAreaView.getParent() != null && this.closeAreaView.getParent() instanceof ViewGroup) {
            ((ViewGroup)this.closeAreaView.getParent()).removeView(this.closeAreaView);
            this.closeAreaView = null;
        }
    }
    
    void removeVideo() {
        if (this.inlineVideoView != null) {
            this.inlineVideoView.removeVideo();
            this.inlineVideoView = null;
        }
    }
    
    void repositionVideoLayout() {
    }
    
    void resumeVideo() {
        if (this.inlineVideoView != null) {
            this.inlineVideoView.resumeVideo();
        }
    }
    
    public void setApid(final String apid) {
        this.adImpl.setApid(apid);
    }
    
    void setCloseArea(final String s) {
        this.post((Runnable)new Runnable() {
            @Override
            public void run() {
                MMLayout.this.internalSetCloseArea(s);
            }
        });
    }
    
    public void setIgnoresDensityScaling(final boolean ignoresDensityScaling) {
        this.adImpl.setIgnoresDensityScaling(ignoresDensityScaling);
    }
    
    public void setListener(final RequestListener listener) {
        this.adImpl.setListener(listener);
    }
    
    public void setMMRequest(final MMRequest mmRequest) {
        this.adImpl.setMMRequest(mmRequest);
    }
    
    void setMediaPlaybackRequiresUserGesture(final boolean b) {
        try {
            WebView.class.getMethod("setMediaPlaybackRequiresUserGesture", Boolean.TYPE).invoke(this, b);
        }
        catch (Exception ex) {}
    }
    
    void setVideoSource(final String videoSource) {
        if (this.inlineVideoView != null) {
            this.inlineVideoView.setVideoSource(videoSource);
        }
    }
    
    void stopVideo() {
        if (this.inlineVideoView != null) {
            this.inlineVideoView.stopVideo();
        }
    }
}
