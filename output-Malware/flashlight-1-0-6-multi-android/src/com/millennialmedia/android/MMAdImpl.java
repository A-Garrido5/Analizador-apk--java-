// 
// Decompiled by Procyon v0.5.30
// 

package com.millennialmedia.android;

import android.graphics.Bitmap;
import java.util.Map;
import android.widget.RelativeLayout$LayoutParams;
import android.content.Context;
import org.json.JSONObject;
import java.lang.ref.WeakReference;

abstract class MMAdImpl implements MMAd
{
    static final String BANNER = "b";
    static final String INTERSTITIAL = "i";
    private static final String TAG = "MMAdImpl";
    private static long nextAdViewId;
    String adType;
    String apid;
    WeakReference contextRef;
    MMAdImplController controller;
    boolean ignoreDensityScaling;
    long internalId;
    boolean isFinishing;
    long lastAdRequest;
    long linkForExpansionId;
    protected MMRequest mmRequest;
    MMWebViewClient mmWebViewClient;
    MMWebViewClient$MMWebViewClientListener mmWebViewClientListener;
    JSONObject obj;
    RequestListener requestListener;
    String userData;
    
    static {
        MMAdImpl.nextAdViewId = 1L;
    }
    
    public MMAdImpl(final Context context) {
        this.ignoreDensityScaling = false;
        this.apid = "28911";
        this.contextRef = new WeakReference((T)context);
        this.mmWebViewClientListener = new MMAdImpl$BasicWebViewClientListener(this);
        synchronized (MMAdImpl.class) {
            this.internalId = MMAdImpl.nextAdViewId;
            ++MMAdImpl.nextAdViewId;
            MMLog.v("MMAdImpl", String.format("Assigning MMAdImpl internal id: %d", this.internalId));
        }
    }
    
    static String[] getAdTypes() {
        return new String[] { "b", "i" };
    }
    
    void addView(final MMWebView mmWebView, final RelativeLayout$LayoutParams relativeLayout$LayoutParams) {
    }
    
    void animateTransition() {
    }
    
    @Override
    public String getApid() {
        return this.apid;
    }
    
    String getCachedName() {
        if (this.adType != null && this.apid != null) {
            return this.adType + "_" + this.apid;
        }
        return null;
    }
    
    abstract MMAd getCallingAd();
    
    Context getContext() {
        if (this.contextRef != null) {
            return (Context)this.contextRef.get();
        }
        return null;
    }
    
    int getId() {
        return -1;
    }
    
    @Override
    public boolean getIgnoresDensityScaling() {
        return this.ignoreDensityScaling;
    }
    
    @Override
    public RequestListener getListener() {
        return this.requestListener;
    }
    
    @Override
    public MMRequest getMMRequest() {
        return this.mmRequest;
    }
    
    MMWebViewClient getMMWebViewClient() {
        MMLog.d("MMAdImpl", "Returning a client for user: DefaultWebViewClient, adimpl=" + this);
        return new BannerWebViewClient(this.mmWebViewClientListener, new MMAdImpl$MMAdImplRedirectionListenerImpl(this));
    }
    
    String getReqType() {
        return "fetch";
    }
    
    String getRequestCompletedAction() {
        return "millennialmedia.action.ACTION_FETCH_SUCCEEDED";
    }
    
    String getRequestFailedAction() {
        return "millennialmedia.action.ACTION_FETCH_FAILED";
    }
    
    public boolean hasCachedVideoSupport() {
        return true;
    }
    
    void insertUrlAdMetaValues(final Map map) {
        final Context context = this.getContext();
        map.put("apid", this.apid);
        map.put("do", MMSDK.getOrientation(context));
        map.put("olock", MMSDK.getOrientationLocked(context));
        if (!this.hasCachedVideoSupport()) {
            map.put("cachedvideo", "false");
        }
        map.put("reqtype", this.getReqType());
        if (this.mmRequest != null) {
            this.mmRequest.getUrlParams(map);
        }
        if (HandShake.sharedHandShake(context).canRequestVideo(context, this.adType)) {
            map.put("video", "true");
        }
        else {
            map.put("video", "false");
        }
        if (this.adType == null) {
            MMLog.e("MMAdImpl", "******* SDK DEFAULTED TO MMBannerAdBottom. THIS MAY AFFECT THE ADS YOU RECIEVE!!! **********");
            map.put("at", "b");
            return;
        }
        if (this.adType.equals("b") || this.adType.equals("i")) {
            map.put("at", this.adType);
            return;
        }
        MMLog.e("MMAdImpl", "******* ERROR: INCORRECT AD TYPE IN MMADVIEW OBJECT PARAMETERS (" + this.adType + ") **********");
    }
    
    public boolean isBanner() {
        return false;
    }
    
    boolean isExpandingToUrl() {
        return false;
    }
    
    boolean isLifecycleObservable() {
        return false;
    }
    
    boolean isRefreshable() {
        if (MMSDK.disableAdMinRefresh) {
            MMLog.d("MMAdImpl", "Minimum adrefresh time ignored");
            return true;
        }
        final long currentTimeMillis = System.currentTimeMillis();
        final int n = (int)((currentTimeMillis - this.lastAdRequest) / 1000L);
        final long adRefreshSecs = HandShake.sharedHandShake(this.getContext()).adRefreshSecs;
        if (n >= adRefreshSecs) {
            this.lastAdRequest = currentTimeMillis;
            return true;
        }
        MMLog.d("MMAdImpl", String.format("Cannot request ad. Last ad request was %d seconds ago. Next ad can be requested in %d seconds.", n, adRefreshSecs - n));
        return false;
    }
    
    boolean isTransitionAnimated() {
        return false;
    }
    
    boolean isUpdatingMraid() {
        return this.controller != null && this.controller.webView != null && !this.controller.webView.isExpanding;
    }
    
    void prepareTransition(final Bitmap bitmap) {
    }
    
    void removeProgressBar() {
    }
    
    void removeView(final MMWebView mmWebView) {
    }
    
    void requestAd() {
        MMAdImplController.assignAdViewController(this);
        if (this.controller != null) {
            this.controller.requestAd();
        }
    }
    
    @Override
    public void setApid(final String s) {
        if (s != null && !s.isEmpty()) {
            HandShake.apid = s;
        }
        this.apid = s;
    }
    
    void setClickable(final boolean b) {
    }
    
    @Override
    public void setIgnoresDensityScaling(final boolean ignoreDensityScaling) {
        this.ignoreDensityScaling = ignoreDensityScaling;
    }
    
    @Override
    public void setListener(final RequestListener requestListener) {
        this.requestListener = requestListener;
    }
    
    @Override
    public void setMMRequest(final MMRequest mmRequest) {
        this.mmRequest = mmRequest;
    }
    
    @Override
    public String toString() {
        return "AdType[(" + this.adType + ") InternalId(" + this.internalId + ") LinkedId(" + this.linkForExpansionId + ") isFinishing(" + this.isFinishing + ")]";
    }
    
    void unresizeToDefault() {
        if (this.controller != null) {
            this.controller.unresizeToDefault();
        }
    }
}
