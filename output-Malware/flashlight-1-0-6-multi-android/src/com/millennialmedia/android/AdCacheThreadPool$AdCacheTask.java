// 
// Decompiled by Procyon v0.5.30
// 

package com.millennialmedia.android;

import android.content.Context;
import java.lang.ref.WeakReference;

class AdCacheThreadPool$AdCacheTask implements Comparable, Runnable
{
    private CachedAd ad;
    private String adName;
    private WeakReference contextRef;
    private WeakReference listenerRef;
    final /* synthetic */ AdCacheThreadPool this$0;
    
    AdCacheThreadPool$AdCacheTask(final AdCacheThreadPool this$0, final Context context, final String adName, final CachedAd ad, final AdCache$AdCacheTaskListener adCache$AdCacheTaskListener) {
        this.this$0 = this$0;
        this.contextRef = new WeakReference((T)context.getApplicationContext());
        this.adName = adName;
        this.ad = ad;
        if (adCache$AdCacheTaskListener != null) {
            this.listenerRef = new WeakReference((T)adCache$AdCacheTaskListener);
        }
    }
    
    public int compareTo(final AdCacheThreadPool$AdCacheTask adCacheThreadPool$AdCacheTask) {
        return this.ad.downloadPriority - adCacheThreadPool$AdCacheTask.ad.downloadPriority;
    }
    
    @Override
    public boolean equals(final Object o) {
        return this == o || (o instanceof AdCacheThreadPool$AdCacheTask && this.ad.equals(((AdCacheThreadPool$AdCacheTask)o).ad));
    }
    
    @Override
    public void run() {
        AdCache$AdCacheTaskListener adCache$AdCacheTaskListener;
        if (this.listenerRef != null) {
            adCache$AdCacheTaskListener = (AdCache$AdCacheTaskListener)this.listenerRef.get();
        }
        else {
            adCache$AdCacheTaskListener = null;
        }
        if (adCache$AdCacheTaskListener != null) {
            adCache$AdCacheTaskListener.downloadStart(this.ad);
        }
        HandShake.sharedHandShake((Context)this.contextRef.get()).lockAdTypeDownload(this.adName);
        final boolean download = this.ad.download((Context)this.contextRef.get());
        HandShake.sharedHandShake((Context)this.contextRef.get()).unlockAdTypeDownload(this.adName);
        if (!download) {
            final String incompleteDownload = AdCache.getIncompleteDownload((Context)this.contextRef.get(), this.adName);
            String adName2 = null;
            Context context4 = null;
            String s2 = null;
            Label_0184: {
                Context context2;
                String s;
                if (incompleteDownload != null && this.ad.getId().equals(incompleteDownload)) {
                    this.ad.delete((Context)this.contextRef.get());
                    final Context context = (Context)this.contextRef.get();
                    final String adName = this.adName;
                    context2 = context;
                    s = adName;
                }
                else {
                    final Context context3 = (Context)this.contextRef.get();
                    adName2 = this.adName;
                    if (!this.ad.downloadAllOrNothing) {
                        final String id = this.ad.getId();
                        context4 = context3;
                        s2 = id;
                        break Label_0184;
                    }
                    final String s3 = adName2;
                    context2 = context3;
                    s = s3;
                }
                context4 = context2;
                adName2 = s;
                s2 = null;
            }
            AdCache.setIncompleteDownload(context4, adName2, s2);
        }
        else {
            AdCache.setIncompleteDownload((Context)this.contextRef.get(), this.adName, null);
        }
        if (adCache$AdCacheTaskListener != null) {
            adCache$AdCacheTaskListener.downloadCompleted(this.ad, download);
        }
    }
}
