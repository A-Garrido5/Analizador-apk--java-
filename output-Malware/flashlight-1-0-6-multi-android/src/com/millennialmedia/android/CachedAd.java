// 
// Decompiled by Procyon v0.5.30
// 

package com.millennialmedia.android;

import java.io.Serializable;
import java.io.ObjectOutput;
import java.io.ObjectInput;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import org.json.JSONObject;
import java.io.File;
import java.io.FileFilter;
import android.content.Context;
import android.os.Parcel;
import java.util.Date;
import java.io.Externalizable;

abstract class CachedAd implements Externalizable
{
    static final int INTERSTITIAL = 2;
    static final int NATIVE = 3;
    private static final String TAG = "CachedAd";
    static final int VIDEO = 1;
    static final long serialVersionUID = 316862728709355974L;
    String acid;
    String contentUrl;
    long deferredViewStart;
    boolean downloadAllOrNothing;
    int downloadPriority;
    Date expiration;
    private String id;
    
    CachedAd() {
        this.downloadAllOrNothing = false;
        this.deferredViewStart = System.currentTimeMillis();
    }
    
    protected CachedAd(final Parcel parcel) {
        this.downloadAllOrNothing = false;
        try {
            this.id = parcel.readString();
            this.acid = parcel.readString();
            this.expiration = (Date)parcel.readSerializable();
            this.deferredViewStart = parcel.readLong();
            final boolean[] array = { false };
            parcel.readBooleanArray(array);
            this.downloadAllOrNothing = array[0];
            this.contentUrl = parcel.readString();
            this.downloadPriority = parcel.readInt();
        }
        catch (Exception ex) {
            ex.printStackTrace();
        }
    }
    
    static CachedAd parseJSON(final String s) {
        Label_0078: {
            if (MMSDK.logLevel >= 5) {
                MMLog.v("CachedAd", "Received cached ad.");
                final int length = s.length();
                if (length > 1000) {
                    int i = 999;
                    int n = 0;
                    while (true) {
                        while (i < length) {
                            MMLog.v("CachedAd", s.substring(n, i));
                            final int n2 = i + 1000;
                            if (n2 > length) {
                                final int n3 = length - 1;
                                MMLog.v("CachedAd", s.substring(i, n3));
                                break Label_0078;
                            }
                            final int n4 = i;
                            i = n2;
                            n = n4;
                        }
                        final int n5 = n;
                        final int n3 = i;
                        i = n5;
                        continue;
                    }
                }
                MMLog.v("CachedAd", s);
            }
        }
        if (s.length() > 0) {
            return new VideoAd(s);
        }
        return null;
    }
    
    abstract boolean canShow(final Context p0, final MMAdImpl p1, final boolean p2);
    
    void delete(final Context context) {
        int i = 0;
        final File internalCacheDirectory = AdCache.getInternalCacheDirectory(context);
        if (internalCacheDirectory != null && internalCacheDirectory.isDirectory()) {
            try {
                final File[] listFiles = internalCacheDirectory.listFiles(new FileFilter() {
                    @Override
                    public boolean accept(final File file) {
                        return file.isFile() && file.getName().startsWith(CachedAd.this.id);
                    }
                });
                MMLog.v("CachedAd", String.format("Deleting %d files for %s.", listFiles.length, this.id));
                while (i < listFiles.length) {
                    listFiles[i].delete();
                    ++i;
                }
            }
            catch (Exception ex) {
                MMLog.e("CachedAd", "Exception deleting cached ad: ", ex);
            }
        }
    }
    
    protected void deserializeFromObj(final JSONObject jsonObject) {
        this.id = jsonObject.optString("id", (String)null);
        this.acid = jsonObject.optString("vid", (String)null);
        this.contentUrl = jsonObject.optString("content-url", (String)null);
        final String optString = jsonObject.optString("expiration", (String)null);
        if (optString == null) {
            return;
        }
        final SimpleDateFormat simpleDateFormat = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss ZZZZ");
        try {
            this.expiration = simpleDateFormat.parse(optString);
        }
        catch (ParseException ex) {
            MMLog.e("CachedAd", "Exception deserializing cached ad: ", ex);
        }
    }
    
    abstract boolean download(final Context p0);
    
    @Override
    public boolean equals(final Object o) {
        return this == o || (o instanceof CachedAd && this.id.equals(((CachedAd)o).id));
    }
    
    String getId() {
        return this.id;
    }
    
    abstract int getType();
    
    abstract String getTypeString();
    
    boolean isExpired() {
        return this.expiration != null && this.expiration.getTime() <= System.currentTimeMillis();
    }
    
    abstract boolean isOnDisk(final Context p0);
    
    boolean isValid() {
        return this.id != null && this.id.length() > 0 && this.contentUrl != null && this.contentUrl.length() > 0;
    }
    
    @Override
    public void readExternal(final ObjectInput objectInput) {
        this.id = (String)objectInput.readObject();
        this.acid = (String)objectInput.readObject();
        this.expiration = (Date)objectInput.readObject();
        this.deferredViewStart = objectInput.readLong();
        this.contentUrl = (String)objectInput.readObject();
    }
    
    abstract boolean saveAssets(final Context p0);
    
    void setId(final String id) {
        this.id = id;
    }
    
    abstract void show(final Context p0, final long p1);
    
    @Override
    public void writeExternal(final ObjectOutput objectOutput) {
        objectOutput.writeObject(this.id);
        objectOutput.writeObject(this.acid);
        objectOutput.writeObject(this.expiration);
        objectOutput.writeLong(this.deferredViewStart);
        objectOutput.writeObject(this.contentUrl);
    }
    
    protected void writeToParcel(final Parcel parcel, final int n) {
        parcel.writeString(this.id);
        parcel.writeString(this.acid);
        parcel.writeSerializable((Serializable)this.expiration);
        parcel.writeLong(this.deferredViewStart);
        parcel.writeBooleanArray(new boolean[] { this.downloadAllOrNothing });
        parcel.writeString(this.contentUrl);
        parcel.writeInt(this.downloadPriority);
    }
}
