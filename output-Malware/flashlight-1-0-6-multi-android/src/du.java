import java.io.ByteArrayOutputStream;
import java.util.Vector;
import java.util.Hashtable;

// 
// Decompiled by Procyon v0.5.30
// 

public class du implements bh, ce
{
    private static final be a;
    private static byte[] m;
    private static int p;
    private static String[] v;
    private Hashtable b;
    private Hashtable c;
    private Hashtable d;
    private cd e;
    private String f;
    private short g;
    private Vector h;
    private bf i;
    private dp j;
    private Vector k;
    private byte[] l;
    private am n;
    private am o;
    private boolean q;
    private dq r;
    private long s;
    private byte t;
    private ci u;
    
    static {
        a = dh.a(du.class);
        du.m = new byte[16];
        du.p = 1;
        du.v = new String[] { "0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "A", "B", "C", "D", "E", "F" };
    }
    
    public du(final String f, final short g, final String s, final byte[] array, final String s2, final Vector vector, final bf i, final dp j) {
        this.l = null;
        this.q = false;
        this.s = 1L;
        this.t = 1;
        this.f = f;
        this.g = g;
        this.i = i;
        this.j = j;
        this.r = null;
        this.k = new Vector();
        this.b = new Hashtable();
        this.c = new Hashtable();
        this.d = new Hashtable();
        this.h = new Vector();
        this.e = new cd(this.f, this.g, s, array, s2, this, vector, i);
    }
    
    public static String a(final byte[] array) {
        if (array == null) {
            return "";
        }
        final StringBuffer sb = new StringBuffer();
        for (int i = 0; i < 16; ++i) {
            final byte b = array[i];
            sb.append(du.v[(byte)(0xF & (byte)((byte)(b & 0xF0) >>> 4))] + du.v[(byte)(b & 0xF)]);
            if (i == 3 || i == 5 || i == 7 || i == 9) {
                sb.append("-");
            }
        }
        return sb.toString().toLowerCase();
    }
    
    private void a(final byte b, final Object o) {
        final bf i = this.i;
        final bg bg = new bg(b, o);
        final Thread currentThread = Thread.currentThread();
        this.i.a();
        i.a(bg, this, currentThread);
    }
    
    private void b(final byte[] array) {
        final byte b = array[16];
        final short a = bu.a(array, 17);
        for (int i = 0; i < this.h.size(); ++i) {
            ((dv)this.h.elementAt(i)).a(b, a);
        }
    }
    
    private void c(final String s) {
        if (this.u == null) {
            return;
        }
        final ck a = this.u.a(s);
        while (true) {
            if (s.compareTo("ConnectionEstablished") != 0) {
                break Label_0043;
            }
            try {
                a.a("SessionID", a(this.l));
                a.a();
            }
            catch (cj cj) {
                continue;
            }
            break;
        }
    }
    
    private void c(final byte[] array) {
        final int b = bu.b(array, 0);
        if (this.c.size() != 0) {
            final dd dd = this.c.get(new Integer(b));
            if (dd == null) {
                du.a.e("Could not find the audio sink associated with AID: " + b);
                return;
            }
            int b2 = bu.b(array, 4);
            int n = 8;
            if (bx.b(this.o)) {
                while ((0x80 & array[n]) > 0) {
                    ++n;
                    --b2;
                }
                ++n;
                --b2;
            }
            while (true) {
                if (b2 > 0 && b2 <= array.length - n) {
                    dv dv;
                    try {
                        dd.a(array, n, b2, false);
                        if (this.d.size() == 0) {
                            return;
                        }
                        dv = this.d.get(new Integer(b));
                        if (dv == null) {
                            du.a.e("parseXModeMsgVapPlay:: Could not find the session listener associated with AID: " + b);
                            return;
                        }
                    }
                    catch (dk dk) {
                        du.a.e(dk.getMessage());
                        continue;
                    }
                    dv.e();
                    return;
                }
                continue;
            }
        }
    }
    
    public static void d() {
    }
    
    private void k() {
        while (!this.k.isEmpty()) {
            final bg bg = this.k.firstElement();
            this.k.removeElementAt(0);
            switch (bg.a) {
                default: {
                    continue;
                }
                case 1: {
                    this.a((byte)1, bg.b);
                    continue;
                }
                case 2: {
                    this.a((byte)2, bg.b);
                    continue;
                }
                case 4: {
                    this.a((byte)4, bg.b);
                    continue;
                }
                case 5: {
                    this.a((byte)5, bg.b);
                    continue;
                }
                case 6: {
                    this.a((byte)6, bg.b);
                    continue;
                }
                case 7: {
                    this.a((byte)7, bg.b);
                    continue;
                }
                case 8: {
                    this.a((byte)8, bg.b);
                    continue;
                }
            }
        }
    }
    
    @Override
    public final void a() {
    }
    
    public final void a(final byte b, final int n, final dv dv) {
        du.a.b("freeResource, TID: " + b + ", disconnect timeout: " + n);
        this.h.removeElement(dv);
        final Object[] array = { new Byte(b), new Integer(n) };
        if (this.l != null && this.k.isEmpty()) {
            this.a((byte)4, array);
            return;
        }
        this.k.addElement(new bg((byte)4, array));
    }
    
    public final void a(final int n) {
        if (du.a.b()) {
            du.a.b("vapRecordBegin, AID: " + n);
        }
        final Integer n2 = new Integer(n);
        if (this.l != null && this.k.isEmpty()) {
            this.a((byte)5, n2);
            return;
        }
        this.k.addElement(new bg((byte)5, n2));
    }
    
    public final void a(final int n, final dd dd, final dv dv) {
        this.c.put(new Integer(n), dd);
        this.d.put(new Integer(n), dv);
    }
    
    public final void a(final am n, final am o) {
        if (du.a.b()) {
            du.a.b("connect()");
        }
        this.c("Connect");
        this.n = n;
        this.o = o;
        this.a((byte)1, null);
    }
    
    @Override
    public final void a(final bs bs, final byte[] array) {
        if (du.a.b()) {
            du.a.b("xmodeMsgCallback, protocol: " + bs.a + ", command: " + bs.b);
        }
        Label_0089: {
            switch (bs.a) {
                default: {
                    du.a.e("Unknown Xmode protocol");
                    break;
                }
                case 3: {
                    switch (bs.b) {
                        case 512:
                        case 768: {
                            break Label_0089;
                        }
                        default: {
                            return;
                        }
                        case 257: {
                            this.l = this.e.b;
                            if (du.a.b()) {
                                du.a.b("connected(" + a(this.l) + ") called on " + this.j);
                            }
                            this.c("ConnectionEstablished");
                            final dp j = this.j;
                            final String a = a(this.l);
                            final dq r = this.r;
                            j.a(a);
                            for (int i = 0; i < this.h.size(); ++i) {
                                ((dv)this.h.elementAt(i)).a(this.l);
                            }
                            this.k();
                            return;
                        }
                    }
                    break;
                }
                case 2: {
                    switch (bs.b) {
                        case 2578: {
                            break Label_0089;
                        }
                        default: {
                            du.a.e("Unknown BCP command");
                            return;
                        }
                        case 2579: {
                            final long n = bu.b(array, 17);
                            bu.a(array, 21);
                            final int b = bu.b(array, 23);
                            if (b > 0 && b <= -27 + array.length) {
                                System.arraycopy(array, 27, new byte[b], 0, b);
                            }
                            this.b.remove(new Long(n));
                            return;
                        }
                        case 2580: {
                            final long n2 = bu.b(array, 17);
                            bu.a(array, 21);
                            final int b2 = bu.b(array, 23);
                            if (b2 > 0 && b2 <= -27 + array.length) {
                                System.arraycopy(array, 27, new byte[b2], 0, b2);
                            }
                            this.b.get(new Long(n2));
                            return;
                        }
                        case 2584: {
                            final byte b3 = array[16];
                            final int b4 = bu.b(array, 17);
                            final short a2 = bu.a(array, 21);
                            final int b5 = bu.b(array, 23);
                            byte[] array2 = null;
                            if (b5 > 0) {
                                final int n3 = -27 + array.length;
                                array2 = null;
                                if (b5 <= n3) {
                                    array2 = new byte[b5];
                                    System.arraycopy(array, 27, array2, 0, b5);
                                }
                            }
                            final dv dv = this.b.remove(new Long(b4));
                            if (dv != null) {
                                dv.b(b3, b4, a2, array2);
                                return;
                            }
                            break Label_0089;
                        }
                        case 2582: {
                            final byte b6 = array[16];
                            final int b7 = bu.b(array, 17);
                            final short a3 = bu.a(array, 21);
                            final int b8 = bu.b(array, 23);
                            byte[] array3 = null;
                            if (b8 > 0) {
                                final int n4 = -27 + array.length;
                                array3 = null;
                                if (b8 <= n4) {
                                    array3 = new byte[b8];
                                    System.arraycopy(array, 27, array3, 0, b8);
                                }
                            }
                            final dv dv2 = this.b.remove(new Long(b7));
                            if (dv2 != null) {
                                dv2.a(b6, b7, a3, array3);
                                return;
                            }
                            break Label_0089;
                        }
                        case 2577: {
                            final long n5 = bu.b(array, 17);
                            bu.b(array, 21);
                            bu.a(array, 25);
                            this.b.remove(new Long(n5));
                            return;
                        }
                        case 2600: {
                            this.b(array);
                            return;
                        }
                        case 2576: {
                            final byte b9 = array[16];
                            final int b10 = bu.b(array, 17);
                            final short a4 = bu.a(array, 21);
                            final short a5 = bu.a(array, 23);
                            final short a6 = bu.a(array, 25);
                            final dv dv3 = this.b.get(new Long(b10));
                            if (dv3 == null) {
                                break Label_0089;
                            }
                            dv3.a(b9, b10, a4, a5, a6);
                            if (a4 != 200) {
                                this.b.remove(new Long(b10));
                                return;
                            }
                            break Label_0089;
                        }
                        case 2585: {
                            final byte b11 = array[16];
                            final int b12 = bu.b(array, 21);
                            if (b12 <= 0 || b12 > -25 + array.length) {
                                break Label_0089;
                            }
                            final byte[] array4 = new byte[b12];
                            System.arraycopy(array, 25, array4, 0, b12);
                            final dv dv4 = this.b.get(new Long(0L));
                            if (dv4 != null) {
                                dv4.a(b11, array4);
                                return;
                            }
                            break Label_0089;
                        }
                    }
                    break;
                }
                case 1: {
                    switch (bs.b) {
                        default: {
                            return;
                        }
                        case 512: {
                            this.c(array);
                            return;
                        }
                        case 528: {
                            final int b13 = bu.b(array, 0);
                            if (this.d.size() == 0) {
                                break Label_0089;
                            }
                            final dv dv5 = this.d.get(new Integer(b13));
                            if (dv5 == null) {
                                du.a.e("parseVapPlayBegin:: Could not find the session listener associated with AID: " + b13);
                                return;
                            }
                            dv5.d();
                            return;
                        }
                        case 1024: {
                            final int b14 = bu.b(array, 0);
                            if (this.c.size() == 0) {
                                break Label_0089;
                            }
                            final dd dd = this.c.remove(new Integer(b14));
                            if (dd == null) {
                                du.a.e("Could not find the audio sink associated with AID: " + b14);
                                return;
                            }
                            dv dv6;
                            while (true) {
                                try {
                                    dd.a(null, 0, 0, true);
                                    dv6 = this.d.remove(new Integer(b14));
                                    if (dv6 == null) {
                                        du.a.e("parseXModeMsgVapPlayEnd:: Could not find the session listener associated with AID: " + b14);
                                        return;
                                    }
                                }
                                catch (dk dk) {
                                    du.a.e(dk.getMessage());
                                    continue;
                                }
                                break;
                            }
                            dv6.f();
                            return;
                        }
                    }
                    break;
                }
            }
        }
    }
    
    public final void a(final ci ci) {
        this.u = ci.a("NMSPSession").a();
        this.e.a(this.u);
    }
    
    public final void a(final dq r) {
        this.r = r;
    }
    
    public final void a(final dv dv) {
        if (!this.h.contains(dv)) {
            this.h.addElement(dv);
        }
    }
    
    @Override
    public final void a(final Object o, final Object o2) {
        final bg bg = (bg)o;
        switch (bg.a) {
            default: {
                du.a.e("Unknown command");
                break;
            }
            case 1: {
                this.e.a(this.n.a(), this.o.a());
            }
            case 2: {
                this.e.b();
            }
            case 3: {
                this.q = true;
                this.e.b();
            }
            case 4: {
                if (this.l != null) {
                    final Object[] array = (Object[])bg.b;
                    final byte byteValue = (byte)array[0];
                    final int intValue = (int)array[1];
                    final byte[] array2 = new byte[5];
                    array2[0] = byteValue;
                    bu.a(intValue, array2, 1);
                    this.e.a(br.a((byte)2, (byte)34, (short)2601, br.a(array2, this.l)), 3, "SEND_BCP_FREE_RESOURCE");
                    return;
                }
                break;
            }
            case 5: {
                if (this.l != null) {
                    this.e.a((int)bg.b);
                    return;
                }
                break;
            }
            case 6: {
                if (this.l != null) {
                    final Object[] array3 = (Object[])bg.b;
                    final byte[] array4 = (byte[])array3[0];
                    final int intValue2 = (int)array3[1];
                    for (int i = 0; i < this.h.size(); ++i) {
                        ((dv)this.h.elementAt(i)).c();
                    }
                    this.e.a(array4, intValue2);
                    return;
                }
                break;
            }
            case 7: {
                if (this.l != null) {
                    this.e.b((int)bg.b);
                    return;
                }
                break;
            }
            case 8: {
                if (this.l == null) {
                    break;
                }
                final Object[] array5 = (Object[])bg.b;
                final short shortValue = (short)array5[0];
                final String s = (String)array5[1];
                final byte[] array6 = (byte[])array5[2];
                final byte[] array7 = (byte[])array5[3];
                final byte byteValue2 = (byte)array5[4];
                final long longValue = (long)array5[5];
                final dv dv = (dv)array5[6];
                final boolean booleanValue = (boolean)array5[7];
                this.b.put(new Long(longValue), dv);
                int n = 5 + array6.length;
                if (shortValue == 2585) {
                    n += 4;
                }
                final byte[] array8 = new byte[n];
                array8[0] = byteValue2;
                int n2 = 1;
                if (shortValue == 2585) {
                    bu.a((int)longValue, array8, 1);
                    n2 = 5;
                }
                bu.a(array6.length, array8, n2);
                System.arraycopy(array6, 0, array8, n2 + 4, array6.length);
                byte[] array9;
                if (this.l != null) {
                    array9 = this.l;
                }
                else {
                    array9 = du.m;
                }
                final byte[] a = br.a(array8, array9);
                final ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
                byteArrayOutputStream.write(a, 0, a.length);
                if (array7 != null) {
                    byteArrayOutputStream.write(array7, 0, array7.length);
                }
                this.e.a(br.a((byte)2, (byte)34, shortValue, byteArrayOutputStream.toByteArray()), 3, s);
                if (!booleanValue) {
                    break;
                }
                if (shortValue == 2581) {
                    if (dv != null) {
                        dv.a(byteValue2, longValue, (short)200, null);
                        return;
                    }
                    break;
                }
                else {
                    if (shortValue == 2608 && dv != null) {
                        this.h.removeElement(dv);
                        dv.b();
                        return;
                    }
                    break;
                }
                break;
            }
        }
    }
    
    @Override
    public final void a(final String s) {
    }
    
    public final void a(final short n, final String s, final byte[] array, final byte[] array2, final byte b, final long n2, final dv dv, final boolean b2) {
        if (du.a.b()) {
            du.a.b("postBcpMessage, BCP: " + n + ", TID: " + b + ", RID: " + n2);
        }
        final Object[] array3 = { new Short(n), s, array, array2, new Byte(b), new Long(n2), dv, new Boolean(b2) };
        if (this.l != null && this.k.isEmpty()) {
            this.a((byte)8, array3);
            return;
        }
        this.k.addElement(new bg((byte)8, array3));
    }
    
    @Override
    public final void a(final short n, final short n2) {
        if (du.a.b()) {
            du.a.b("socketClosed, reason: " + n);
        }
        if (du.a.b()) {
            du.a.b("socketClosed() sessionListeners.size():" + this.h.size());
        }
        for (int i = 0; i < this.h.size(); ++i) {
            ((dv)this.h.elementAt(i)).a(n);
        }
        if (!this.k.isEmpty()) {
            this.k.removeAllElements();
        }
        this.h.removeAllElements();
        if (n == 4 || n == 5) {
            final dp j = this.j;
            final dq r = this.r;
            j.b((short)9);
        }
        else if (n == 7) {
            final dp k = this.j;
            final dq r2 = this.r;
            k.b(n2);
        }
        else if (n == 8 && this.l == null) {
            final dp l = this.j;
            final dq r3 = this.r;
            l.b((short)9);
        }
        else if (this.l != null) {
            final dp m = this.j;
            final dq r4 = this.r;
            m.a(n2);
        }
        if (n == 1 && this.q) {
            this.i.c();
            this.j.a();
        }
        this.l = null;
    }
    
    public final void a(final byte[] array, final int n) {
        if (du.a.b()) {
            du.a.b("vapRecord, AID: " + n);
        }
        final Object[] array2 = { array, new Integer(n) };
        if (this.l != null && this.k.isEmpty()) {
            this.a((byte)6, array2);
            return;
        }
        this.k.addElement(new bg((byte)6, array2));
    }
    
    public final cd b() {
        return this.e;
    }
    
    public final void b(final int n) {
        if (du.a.b()) {
            du.a.b("vapRecordEnd, AID: " + n);
        }
        final Integer n2 = new Integer(n);
        if (this.l != null && this.k.isEmpty()) {
            this.a((byte)7, n2);
            return;
        }
        this.k.addElement(new bg((byte)7, n2));
    }
    
    public final void b(final dv dv) {
        this.h.removeElement(dv);
    }
    
    @Override
    public final void b(final String s) {
    }
    
    public final int c() {
        synchronized (this) {
            final int p = du.p;
            du.p = p + 1;
            if (du.p == Integer.MIN_VALUE) {
                du.p = 1;
            }
            return p;
        }
    }
    
    public final void e() {
        if (du.a.b()) {
            du.a.b("disconnectAndShutdown");
        }
        this.a((byte)3, null);
    }
    
    public final byte[] f() {
        return this.l;
    }
    
    public final long g() {
        final long n = this.s++;
        if (this.s == Long.MIN_VALUE) {
            this.s = 1L;
        }
        return n;
    }
    
    public final byte h() {
        final byte t = this.t;
        this.t = (byte)(t + 1);
        if (this.t == -128) {
            this.t = 1;
        }
        return t;
    }
    
    public final am i() {
        return this.n;
    }
    
    public final ci j() {
        return this.u;
    }
}
